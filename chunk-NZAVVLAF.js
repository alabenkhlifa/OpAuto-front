import{a as ae}from"./chunk-BGMVLO5C.js";import{a as ne}from"./chunk-ATINUOUM.js";import"./chunk-UJO3757W.js";import{b as q,c as s,d as z,e as J,i as $,j as H,l as R,m as L,n as Y,o as K,p as Q,q as U,r as W,s as X,t as Z,x as ee,z as te}from"./chunk-O3CTDYVO.js";import{c as ie}from"./chunk-ECECQ7NF.js";import{c as j,e as A}from"./chunk-5NENZ4M5.js";import{$ as M,$a as u,Ab as c,Ca as N,Sa as x,Ta as f,U as h,Ua as O,Wa as S,Xa as w,Ya as b,Z as B,Za as i,_ as P,_a as t,a as I,aa as y,ab as V,ac as D,b as T,bb as k,cb as F,ga as C,ib as v,kb as r,lb as p,mb as m,ob as G,sa as n,zb as d}from"./chunk-DMTVNCDT.js";var re=(o,e)=>e.id;function le(o,e){if(o&1&&(i(0,"option",20),r(1),t()),o&2){let a=e.$implicit;b("value",a.id),n(),G("",a.licensePlate," - ",a.make," ",a.model)}}function de(o,e){o&1&&(i(0,"p",21),r(1,"Vehicle is required"),t())}function ce(o,e){if(o&1&&(i(0,"option",20),r(1),t()),o&2){let a=e.$implicit;b("value",a.id),n(),p(a.name)}}function me(o,e){o&1&&(i(0,"p",21),r(1,"Mechanic is required"),t())}function se(o,e){o&1&&(i(0,"p",21),r(1,"Job title is required"),t())}function pe(o,e){o&1&&(i(0,"p",21),r(1,"Valid mileage is required"),t())}function ue(o,e){o&1&&(i(0,"p",21),r(1,"Description is required"),t())}function be(o,e){if(o&1){let a=V();i(0,"div",40)(1,"div",45)(2,"div")(3,"label",17),r(4," Task Name * "),t(),u(5,"input",46),t(),i(6,"div")(7,"label",17),r(8," Estimated Time (min) "),t(),u(9,"input",47),t(),i(10,"div",48)(11,"button",49),k("click",function(){let g=B(a).$index,E=F();return P(E.removeTask(g))}),r(12," Remove "),t()()(),i(13,"div",50)(14,"label",17),r(15," Task Description "),t(),i(16,"textarea",51),r(17,"                  "),t()()()}if(o&2){let a=e.$index;b("formGroupName",a)}}function ge(o,e){o&1&&(i(0,"div",41)(1,"p",52),r(2),d(3,"translate"),t()()),o&2&&(n(2),p(c(3,1,"maintenance.new.noTasks")))}function xe(o,e){o&1&&(M(),i(0,"svg",53),u(1,"circle",54)(2,"path",55),t(),r(3," Saving... "))}function fe(o,e){if(o&1&&(r(0),d(1,"translate"),d(2,"translate")),o&2){let a=F();m(" ",a.isEditMode()?c(1,1,"maintenance.new.updateJob"):c(2,3,"maintenance.new.createJob")," ")}}var oe=class o{fb=h(ee);router=h(A);route=h(j);maintenanceService=h(ae);carService=h(ne);maintenanceForm;cars=C([]);serviceTypes=C([]);isSubmitting=C(!1);jobId=C(null);isEditMode=C(!1);mechanics=[{id:"mechanic-001",name:"Mohamed Trabelsi"},{id:"mechanic-002",name:"Ali Sassi"},{id:"mechanic-003",name:"Ahmed Bouzid"}];ngOnInit(){this.initializeForm(),this.loadData(),this.checkEditMode()}initializeForm(){this.maintenanceForm=this.fb.group({carId:["",s.required],mechanicId:["",s.required],jobTitle:["",s.required],description:["",s.required],priority:["medium",s.required],currentMileage:[0,[s.required,s.min(0)]],estimatedCost:[0,[s.min(0)]],estimatedDuration:[60,[s.min(5)]],notes:[""],tasks:this.fb.array([])})}loadData(){this.carService.getCars().subscribe({next:e=>this.cars.set(e),error:e=>console.error("Error loading cars:",e)}),this.maintenanceService.getServiceTypes().subscribe({next:e=>this.serviceTypes.set(e),error:e=>console.error("Error loading service types:",e)})}checkEditMode(){let e=this.route.snapshot.paramMap.get("id");e&&(this.jobId.set(e),this.isEditMode.set(!0),this.loadMaintenanceJob(e))}loadMaintenanceJob(e){this.maintenanceService.getMaintenanceJob(e).subscribe({next:a=>{a?this.populateForm(a):(console.error("Job not found"),this.goBack())},error:a=>{console.error("Error loading job:",a),this.goBack()}})}populateForm(e){this.maintenanceForm.patchValue({carId:e.carId,mechanicId:e.mechanicId,jobTitle:e.jobTitle,description:e.description,priority:e.priority,currentMileage:e.currentMileage,estimatedCost:e.estimatedCost,estimatedDuration:e.estimatedDuration,notes:e.notes});let a=this.tasks;a.clear(),e.tasks.forEach(l=>{a.push(this.createTaskFormGroup(l))})}get tasks(){return this.maintenanceForm.get("tasks")}addTask(){this.tasks.push(this.createTaskFormGroup())}removeTask(e){this.tasks.removeAt(e)}createTaskFormGroup(e){return this.fb.group({id:[e?.id||this.generateTaskId()],name:[e?.name||"",s.required],description:[e?.description||""],status:[e?.status||"pending"],estimatedTime:[e?.estimatedTime||30,[s.min(5),s.max(480)]],assignedMechanicId:[e?.assignedMechanicId||""]})}onSubmit(){if(this.maintenanceForm.valid){this.isSubmitting.set(!0);let e=this.maintenanceForm.value,a=this.cars().find(_=>_.id===e.carId),l=this.mechanics.find(_=>_.id===e.mechanicId),g=T(I({},e),{licensePlate:a?.licensePlate||"",customerName:"Customer Name",mechanicName:l?.name||"",carDetails:a?`${a.year} ${a.make} ${a.model}`:"",customerId:a?.customerId||"",photos:[],approvalRequests:[],status:"waiting"});(this.isEditMode()?this.maintenanceService.updateMaintenanceJob(this.jobId(),g):this.maintenanceService.createMaintenanceJob(g)).subscribe({next:()=>{this.isSubmitting.set(!1),this.goBack()},error:_=>{console.error("Error saving job:",_),this.isSubmitting.set(!1)}})}else this.markFormGroupTouched()}isFieldInvalid(e){let a=this.maintenanceForm.get(e);return!!(a&&a.invalid&&(a.dirty||a.touched))}markFormGroupTouched(){Object.keys(this.maintenanceForm.controls).forEach(e=>{this.maintenanceForm.get(e)?.markAsTouched()})}generateTaskId(){return"task-"+Math.random().toString(36).substr(2,9)}goBack(){this.router.navigate(["/maintenance/active"])}static \u0275fac=function(a){return new(a||o)};static \u0275cmp=N({type:o,selectors:[["app-maintenance-form"]],decls:117,vars:92,consts:[[1,"p-6","max-w-4xl","mx-auto"],[1,"glass-card","mb-6"],[1,"flex","items-start","space-x-6"],[1,"p-3","text-gray-400","hover:text-white","transition-colors","bg-gray-800/50","rounded-lg","hover:bg-gray-700/50",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"flex-1"],[1,"text-3xl","lg:text-4xl","font-bold","text-white","mb-2"],[1,"bg-gray-800/30","rounded-lg","p-4","backdrop-filter","backdrop-blur-sm"],[1,"flex","items-center","space-x-3"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6","text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"text-lg","font-medium","text-blue-300"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"glass-card"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-300","mb-1"],["formControlName","carId",1,"form-select"],["value",""],[3,"value"],[1,"mt-1","text-sm","text-red-400"],["formControlName","mechanicId",1,"form-select"],["type","text","formControlName","jobTitle",1,"form-input",3,"placeholder"],["formControlName","priority",1,"form-select"],["value","low"],["value","medium"],["value","high"],["value","urgent"],["type","number","formControlName","currentMileage","placeholder","85000","min","0","max","999999",1,"form-input"],["type","number","formControlName","estimatedCost","placeholder","150","min","0","step","0.01",1,"form-input"],[1,"mt-4"],["formControlName","description","rows","3",1,"form-textarea",3,"placeholder"],["formControlName","notes","rows","2",1,"form-textarea",3,"placeholder"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"btn-secondary","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","tasks",1,"space-y-4"],[1,"p-4","border","border-gray-200","dark:border-gray-600","rounded-lg",3,"formGroupName"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","justify-end","space-x-4","pt-6"],["type","button",1,"btn-secondary",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["type","text","formControlName","name","placeholder","e.g., Replace brake pads",1,"form-input","text-sm"],["type","number","formControlName","estimatedTime","placeholder","60","min","5","max","480",1,"form-input","text-sm"],[1,"flex","items-end"],["type","button",1,"w-full","btn-danger","text-sm","py-2",3,"click"],[1,"mt-3"],["formControlName","description","rows","2","placeholder","Detailed description of what needs to be done...",1,"form-textarea","text-sm"],[1,"text-sm"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-2","h-4","w-4","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(a,l){a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),k("click",function(){return l.goBack()}),M(),i(4,"svg",4),u(5,"path",5),t()(),y(),i(6,"div",6)(7,"h1",7),r(8),d(9,"translate"),d(10,"translate"),t(),i(11,"div",8)(12,"div",9),M(),i(13,"svg",10),u(14,"path",11),t(),y(),i(15,"p",12),r(16),d(17,"translate"),t()()()()()(),i(18,"form",13),k("ngSubmit",function(){return l.onSubmit()}),i(19,"div",14)(20,"h2",15),r(21),d(22,"translate"),t(),i(23,"div",16)(24,"div")(25,"label",17),r(26),d(27,"translate"),t(),i(28,"select",18)(29,"option",19),r(30),d(31,"translate"),t(),S(32,le,2,4,"option",20,re),t(),x(34,de,2,0,"p",21),t(),i(35,"div")(36,"label",17),r(37),d(38,"translate"),t(),i(39,"select",22)(40,"option",19),r(41),d(42,"translate"),t(),S(43,ce,2,2,"option",20,re),t(),x(45,me,2,0,"p",21),t(),i(46,"div")(47,"label",17),r(48),d(49,"translate"),t(),u(50,"input",23),d(51,"translate"),x(52,se,2,0,"p",21),t(),i(53,"div")(54,"label",17),r(55),d(56,"translate"),t(),i(57,"select",24)(58,"option",25),r(59),d(60,"translate"),t(),i(61,"option",26),r(62),d(63,"translate"),t(),i(64,"option",27),r(65),d(66,"translate"),t(),i(67,"option",28),r(68),d(69,"translate"),t()()(),i(70,"div")(71,"label",17),r(72),d(73,"translate"),t(),u(74,"input",29),x(75,pe,2,0,"p",21),t(),i(76,"div")(77,"label",17),r(78),d(79,"translate"),t(),u(80,"input",30),t()(),i(81,"div",31)(82,"label",17),r(83),d(84,"translate"),t(),i(85,"textarea",32),d(86,"translate"),r(87,"            "),t(),x(88,ue,2,0,"p",21),t(),i(89,"div",31)(90,"label",17),r(91),d(92,"translate"),t(),i(93,"textarea",33),d(94,"translate"),r(95,"            "),t()()(),i(96,"div",14)(97,"div",34)(98,"h2",35),r(99),d(100,"translate"),t(),i(101,"button",36),k("click",function(){return l.addTask()}),M(),i(102,"svg",37),u(103,"path",38),t(),r(104),d(105,"translate"),t()(),y(),i(106,"div",39),S(107,be,18,1,"div",40,O),t(),x(109,ge,4,3,"div",41),t(),i(110,"div",42)(111,"button",43),k("click",function(){return l.goBack()}),r(112),d(113,"translate"),t(),i(114,"button",44),x(115,xe,4,0)(116,fe,3,5),t()()()()),a&2&&(n(8),m(" ",l.isEditMode()?c(9,44,"maintenance.new.editTitle"):c(10,46,"maintenance.new.title")," "),n(8),m(" ",c(17,48,"maintenance.new.subtitle")," "),n(2),b("formGroup",l.maintenanceForm),n(3),p(c(22,50,"maintenance.new.basicInfo")),n(5),m(" ",c(27,52,"maintenance.new.vehicle")," * "),n(2),v("border-red-500",l.isFieldInvalid("carId")),n(2),p(c(31,54,"maintenance.new.selectVehicle")),n(2),w(l.cars()),n(2),f(l.isFieldInvalid("carId")?34:-1),n(3),m(" ",c(38,56,"maintenance.new.assignedMechanic")," * "),n(2),v("border-red-500",l.isFieldInvalid("mechanicId")),n(2),p(c(42,58,"maintenance.new.selectMechanic")),n(2),w(l.mechanics),n(2),f(l.isFieldInvalid("mechanicId")?45:-1),n(3),m(" ",c(49,60,"maintenance.new.jobTitle")," * "),n(2),v("border-red-500",l.isFieldInvalid("jobTitle")),b("placeholder",c(51,62,"maintenance.new.jobTitlePlaceholder")),n(2),f(l.isFieldInvalid("jobTitle")?52:-1),n(3),m(" ",c(56,64,"maintenance.new.priority")," * "),n(2),v("border-red-500",l.isFieldInvalid("priority")),n(2),p(c(60,66,"maintenance.priority.low")),n(3),p(c(63,68,"maintenance.priority.medium")),n(3),p(c(66,70,"maintenance.priority.high")),n(3),p(c(69,72,"maintenance.priority.urgent")),n(4),m(" ",c(73,74,"maintenance.new.currentMileage")," * "),n(2),v("border-red-500",l.isFieldInvalid("currentMileage")),n(),f(l.isFieldInvalid("currentMileage")?75:-1),n(3),m(" ",c(79,76,"maintenance.new.estimatedCost")," "),n(5),m(" ",c(84,78,"maintenance.new.description")," * "),n(2),v("border-red-500",l.isFieldInvalid("description")),b("placeholder",c(86,80,"maintenance.new.descriptionPlaceholder")),n(3),f(l.isFieldInvalid("description")?88:-1),n(3),m(" ",c(92,82,"maintenance.new.additionalNotes")," "),n(2),b("placeholder",c(94,84,"maintenance.new.additionalNotesPlaceholder")),n(6),p(c(100,86,"maintenance.new.tasks")),n(5),m(" ",c(105,88,"maintenance.new.addTask")," "),n(3),w(l.tasks.controls),n(2),f(l.tasks.length===0?109:-1),n(3),m(" ",c(113,90,"maintenance.new.cancel")," "),n(2),b("disabled",l.maintenanceForm.invalid||l.isSubmitting()),n(),f(l.isSubmitting()?115:116))},dependencies:[D,te,$,U,W,q,H,Q,z,J,Z,X,R,K,L,Y,ie],styles:[".glass-card[_ngcontent-%COMP%]{background:#111827f2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(75,85,99,.6);border-radius:20px;padding:1.5rem;box-shadow:0 8px 32px #000000b3;transition:all .3s cubic-bezier(.4,0,.2,1);margin-bottom:1rem}.glass-card[_ngcontent-%COMP%]:hover{background:#1f2937fa;box-shadow:0 12px 40px #000c;border-color:#3b82f6b3;transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#059669,#047857);border:1px solid #059669;color:#fff!important;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #0596694d}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#047857,#065f46);box-shadow:0 6px 20px #05966966;transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6cc,#1d4ed8cc);border:1px solid rgba(59,130,246,.6);color:#fff;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #3b82f64d}.btn-secondary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3b82f6e6,#1d4ed8e6);box-shadow:0 6px 20px #3b82f666;transform:translateY(-1px)}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc2626,#991b1b);border:1px solid #dc2626;color:#fff!important;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #dc26264d}.btn-danger[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#991b1b,#7f1d1d);box-shadow:0 6px 20px #dc262666;transform:translateY(-1px)}.glass-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-900[_ngcontent-%COMP%]{color:#fff!important}.glass-card[_ngcontent-%COMP%]   .text-gray-500[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-400[_ngcontent-%COMP%]{color:#9ca3af!important}.glass-card[_ngcontent-%COMP%]   .text-gray-700[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-600[_ngcontent-%COMP%]{color:#d1d5db!important}"]})};export{oe as MaintenanceFormComponent};
