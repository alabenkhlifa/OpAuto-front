import{F as l,a as u,b as d,f as p,h as n,u as C}from"./chunk-6MGQ6QS3.js";var h=class c{customersSubject=new p([]);customers$=this.customersSubject.asObservable();searchQuery=l("");selectedStatus=l("all");selectedCity=l("all");mockCustomers=[{id:"customer1",name:"Ahmed Ben Ali",phone:"+216-20-123-456",email:"ahmed.benali@email.tn",address:{street:"15 Avenue Bourguiba",city:"Tunis",postalCode:"1000",country:"Tunisia"},registrationDate:new Date(2024,0,15),lastVisitDate:new Date(2025,6,15),totalCars:2,totalAppointments:15,totalInvoices:12,totalSpent:2850.5,averageSpending:237.54,status:"vip",notes:"Loyal customer since 2024. Prefers morning appointments.",preferredContactMethod:"phone",loyaltyPoints:285,referralSource:"Facebook",createdAt:new Date(2024,0,15),updatedAt:new Date(2025,6,15)},{id:"customer2",name:"Fatma Trabelsi",phone:"+216-25-789-123",email:"fatma.trabelsi@email.tn",address:{street:"42 Rue de la R\xE9publique",city:"Sfax",postalCode:"3000",country:"Tunisia"},registrationDate:new Date(2024,2,22),lastVisitDate:new Date(2025,5,20),totalCars:1,totalAppointments:8,totalInvoices:7,totalSpent:1650.75,averageSpending:235.82,status:"active",notes:"Works in healthcare. Flexible with scheduling.",preferredContactMethod:"email",loyaltyPoints:165,referralSource:"Friend referral",createdAt:new Date(2024,2,22),updatedAt:new Date(2025,5,20)},{id:"customer3",name:"Mohamed Khemir",phone:"+216-22-456-789",email:"mohamed.khemir@email.tn",address:{street:"78 Avenue Habib Bourguiba",city:"Sousse",postalCode:"4000",country:"Tunisia"},registrationDate:new Date(2024,4,10),lastVisitDate:new Date(2025,7,1),totalCars:1,totalAppointments:3,totalInvoices:3,totalSpent:890.25,averageSpending:296.75,status:"active",notes:"Business owner, prefers luxury car services.",preferredContactMethod:"whatsapp",loyaltyPoints:89,referralSource:"Google Search",createdAt:new Date(2024,4,10),updatedAt:new Date(2025,7,1)},{id:"customer4",name:"Leila Mansouri",phone:"+216-28-654-321",email:"leila.mansouri@email.tn",address:{street:"23 Rue Ibn Khaldoun",city:"Tunis",postalCode:"1002",country:"Tunisia"},registrationDate:new Date(2024,7,5),lastVisitDate:new Date(2025,6,25),totalCars:1,totalAppointments:5,totalInvoices:5,totalSpent:1320,averageSpending:264,status:"active",notes:"Teacher, prefers afternoon appointments after work.",preferredContactMethod:"phone",loyaltyPoints:132,referralSource:"Colleague referral",createdAt:new Date(2024,7,5),updatedAt:new Date(2025,6,25)},{id:"customer5",name:"Youssef Hammami",phone:"+216-29-987-654",email:"youssef.hammami@email.tn",registrationDate:new Date(2025,0,12),totalCars:1,totalAppointments:1,totalInvoices:1,totalSpent:125.5,averageSpending:125.5,status:"active",notes:"New customer, first service completed.",preferredContactMethod:"sms",loyaltyPoints:13,referralSource:"Walk-in",createdAt:new Date(2025,0,12),updatedAt:new Date(2025,0,12)},{id:"customer6",name:"Samira Bouzid",phone:"+216-24-321-987",registrationDate:new Date(2023,11,8),lastVisitDate:new Date(2024,8,15),totalCars:2,totalAppointments:25,totalInvoices:20,totalSpent:4250.8,averageSpending:212.54,status:"inactive",notes:"Former regular customer. Has not visited in 6+ months.",preferredContactMethod:"phone",loyaltyPoints:425,referralSource:"Family referral",createdAt:new Date(2023,11,8),updatedAt:new Date(2024,8,15)}];constructor(){this.customersSubject.next(this.mockCustomers)}getCustomers(){return this.customers$}getCustomerById(t){return n(this.mockCustomers.find(e=>e.id===t))}getCustomerStats(){let t=this.mockCustomers.length,e=this.mockCustomers.filter(a=>a.status==="active").length,s=this.mockCustomers.filter(a=>a.status==="vip").length,r=new Date().getMonth(),o=new Date().getFullYear(),i=this.mockCustomers.filter(a=>a.registrationDate.getMonth()===r&&a.registrationDate.getFullYear()===o).length,g=this.mockCustomers.reduce((a,m)=>a+m.totalSpent,0)/t,y=[...this.mockCustomers].sort((a,m)=>m.totalSpent-a.totalSpent).slice(0,5).map(a=>this.mapToCustomerSummary(a)),S={active:this.mockCustomers.filter(a=>a.status==="active").length,inactive:this.mockCustomers.filter(a=>a.status==="inactive").length,vip:this.mockCustomers.filter(a=>a.status==="vip").length,blocked:this.mockCustomers.filter(a=>a.status==="blocked").length},D=[...this.mockCustomers].sort((a,m)=>new Date(m.registrationDate).getTime()-new Date(a.registrationDate).getTime()).slice(0,5).map(a=>this.mapToCustomerSummary(a));return n({totalCustomers:t,activeCustomers:e,vipCustomers:s,newCustomersThisMonth:i,averageCustomerValue:g,topCustomers:y,customersByStatus:S,recentCustomers:D})}searchCustomers(t){let e=[...this.mockCustomers];if(t.query){let s=t.query.toLowerCase();e=e.filter(r=>r.name.toLowerCase().includes(s)||r.phone.includes(s)||r.email?.toLowerCase().includes(s)||r.address?.city.toLowerCase().includes(s))}return t.status&&(e=e.filter(s=>s.status===t.status)),t.city&&(e=e.filter(s=>s.address?.city===t.city)),t.registrationDateFrom&&(e=e.filter(s=>s.registrationDate>=t.registrationDateFrom)),t.registrationDateTo&&(e=e.filter(s=>s.registrationDate<=t.registrationDateTo)),t.minSpent!==void 0&&(e=e.filter(s=>s.totalSpent>=t.minSpent)),t.maxSpent!==void 0&&(e=e.filter(s=>s.totalSpent<=t.maxSpent)),t.hasEmail!==void 0&&(e=e.filter(s=>t.hasEmail?!!s.email:!s.email)),t.sortBy&&e.sort((s,r)=>{let o,i;switch(t.sortBy){case"name":o=s.name.toLowerCase(),i=r.name.toLowerCase();break;case"registrationDate":o=s.registrationDate.getTime(),i=r.registrationDate.getTime();break;case"lastVisitDate":o=s.lastVisitDate?.getTime()||0,i=r.lastVisitDate?.getTime()||0;break;case"totalSpent":o=s.totalSpent,i=r.totalSpent;break;case"totalAppointments":o=s.totalAppointments,i=r.totalAppointments;break;default:return 0}return o<i?t.sortOrder==="desc"?1:-1:o>i?t.sortOrder==="desc"?-1:1:0}),n(e)}getCustomerHistory(t){let e=[{id:"app1",date:new Date(2025,6,15),serviceName:"Oil Change & Filter",carMake:"BMW",carModel:"X5",licensePlate:"123 TUN 2024",status:"completed",totalCost:85.5},{id:"app2",date:new Date(2025,5,20),serviceName:"Brake System Check",carMake:"Toyota",carModel:"Camry",licensePlate:"789 TUN 2021",status:"completed",totalCost:245.75}],s=[{id:"inv1",invoiceNumber:"INV-2025-001",date:new Date(2025,6,15),amount:85.5,status:"paid",serviceName:"Oil Change & Filter",dueDate:new Date(2025,6,29)},{id:"inv2",invoiceNumber:"INV-2025-002",date:new Date(2025,5,20),amount:245.75,status:"paid",serviceName:"Brake System Check",dueDate:new Date(2025,6,4)}],r=[{id:"car1",licensePlate:"123 TUN 2024",make:"BMW",model:"X5",year:2020,registrationDate:new Date(2024,0,15),lastServiceDate:new Date(2025,6,15),totalServices:8,totalSpent:1425.5},{id:"car3",licensePlate:"789 TUN 2021",make:"Toyota",model:"Camry",year:2021,registrationDate:new Date(2024,8,10),lastServiceDate:new Date(2025,4,10),totalServices:5,totalSpent:1425}];return n({appointments:e,invoices:s,cars:r})}createCustomer(t){let e=d(u({id:Date.now().toString()},t),{registrationDate:new Date,totalCars:0,totalAppointments:0,totalInvoices:0,totalSpent:0,averageSpending:0,status:"active",loyaltyPoints:0,createdAt:new Date,updatedAt:new Date});return this.mockCustomers.push(e),this.customersSubject.next([...this.mockCustomers]),n(e)}updateCustomer(t,e){let s=this.mockCustomers.findIndex(r=>r.id===t);if(s!==-1)return this.mockCustomers[s]=d(u(u({},this.mockCustomers[s]),e),{updatedAt:new Date}),this.customersSubject.next([...this.mockCustomers]),n(this.mockCustomers[s]);throw new Error("Customer not found")}deleteCustomer(t){let e=this.mockCustomers.findIndex(s=>s.id===t);return e!==-1?(this.mockCustomers.splice(e,1),this.customersSubject.next([...this.mockCustomers]),n(!0)):n(!1)}getAvailableCities(){let t=[...new Set(this.mockCustomers.map(e=>e.address?.city).filter(e=>!!e))].sort();return n(t)}getCustomersByStatus(t){let e=this.mockCustomers.filter(s=>s.status===t);return n(e)}getTopCustomers(t=5){let e=[...this.mockCustomers].sort((s,r)=>r.totalSpent-s.totalSpent).slice(0,t).map(s=>this.mapToCustomerSummary(s));return n(e)}getRecentCustomers(t=5){let e=[...this.mockCustomers].sort((s,r)=>new Date(r.registrationDate).getTime()-new Date(s.registrationDate).getTime()).slice(0,t).map(s=>this.mapToCustomerSummary(s));return n(e)}updateCustomerStatus(t,e){return this.updateCustomer(t,{status:e})}addLoyaltyPoints(t,e){let s=this.mockCustomers.find(r=>r.id===t);if(s){let r=s.loyaltyPoints+e;return this.updateCustomer(t,{loyaltyPoints:r})}throw new Error("Customer not found")}getCustomerMetrics(t){let e=this.mockCustomers.find(i=>i.id===t);if(!e)throw new Error("Customer not found");let s=Math.floor((new Date().getTime()-e.registrationDate.getTime())/(1e3*60*60*24*30)),r=e.totalAppointments/Math.max(s,1),o=e.totalSpent/Math.max(s,1);return n({customer:e,monthsSinceRegistration:s,appointmentsPerMonth:Math.round(r*10)/10,revenuePerMonth:Math.round(o*100)/100,loyaltyTier:this.getLoyaltyTier(e.loyaltyPoints),nextTierProgress:this.getNextTierProgress(e.loyaltyPoints)})}mapToCustomerSummary(t){return{id:t.id,name:t.name,phone:t.phone,email:t.email,status:t.status,totalSpent:t.totalSpent,lastVisitDate:t.lastVisitDate,totalCars:t.totalCars}}getLoyaltyTier(t){return t>=500?"Platinum":t>=250?"Gold":t>=100?"Silver":"Bronze"}getNextTierProgress(t){if(t>=500)return{nextTier:"Platinum",pointsNeeded:0,progress:100};if(t>=250){let r=500-t,o=(t-250)/250*100;return{nextTier:"Platinum",pointsNeeded:r,progress:o}}if(t>=100){let r=250-t,o=(t-100)/150*100;return{nextTier:"Gold",pointsNeeded:r,progress:o}}let e=100-t,s=t/100*100;return{nextTier:"Silver",pointsNeeded:e,progress:s}}static \u0275fac=function(e){return new(e||c)};static \u0275prov=C({token:c,factory:c.\u0275fac,providedIn:"root"})};export{h as a};
