import{a as te}from"./chunk-5P3BWFFY.js";import{a as ee}from"./chunk-LBMXZOCT.js";import{b as B,c as d,d as J,e as j,h as q,i as z,k as $,l as H,m as R,n as L,o as Y,p as U,q as K,r as Q,s as W,u as X,w as Z}from"./chunk-VYILSR5J.js";import{$ as M,A as w,B as v,C,E as g,J as l,M as I,Pa as A,Ua as G,W as c,Wa as D,X as p,Y as N,_ as k,a as E,aa as f,b as F,ba as i,ca as t,da as m,ea as P,fa as x,ga as y,ma as u,oa as r,pa as O,qa as _,sa as V,x as b,z as T}from"./chunk-JES5V5RQ.js";var ie=(o,e)=>e.id;function re(o,e){if(o&1&&(i(0,"option",20),r(1),t()),o&2){let n=e.$implicit;f("value",n.id),l(),V("",n.licensePlate," - ",n.make," ",n.model)}}function ae(o,e){o&1&&(i(0,"p",21),r(1,"Vehicle is required"),t())}function oe(o,e){if(o&1&&(i(0,"option",20),r(1),t()),o&2){let n=e.$implicit;f("value",n.id),l(),O(n.name)}}function le(o,e){o&1&&(i(0,"p",21),r(1,"Mechanic is required"),t())}function de(o,e){o&1&&(i(0,"p",21),r(1,"Job title is required"),t())}function me(o,e){o&1&&(i(0,"p",21),r(1,"Valid mileage is required"),t())}function se(o,e){o&1&&(i(0,"p",21),r(1,"Description is required"),t())}function ce(o,e){if(o&1){let n=P();i(0,"div",40)(1,"div",45)(2,"div")(3,"label",17),r(4," Task Name * "),t(),m(5,"input",46),t(),i(6,"div")(7,"label",17),r(8," Estimated Time (min) "),t(),m(9,"input",47),t(),i(10,"div",48)(11,"button",49),x("click",function(){let s=T(n).$index,S=y();return w(S.removeTask(s))}),r(12," Remove "),t()()(),i(13,"div",50)(14,"label",17),r(15," Task Description "),t(),i(16,"textarea",51),r(17,"                  "),t()()()}if(o&2){let n=e.$index;f("formGroupName",n)}}function pe(o,e){o&1&&(i(0,"div",41)(1,"p",52),r(2,'No tasks added yet. Click "Add Task" to get started.'),t()())}function ue(o,e){o&1&&(v(),i(0,"svg",53),m(1,"circle",54)(2,"path",55),t(),r(3," Saving... "))}function be(o,e){if(o&1&&r(0),o&2){let n=y();_(" ",n.isEditMode()?"Update Job":"Create Job"," ")}}var ne=class o{fb=b(X);router=b(D);route=b(G);maintenanceService=b(te);carService=b(ee);maintenanceForm;cars=g([]);serviceTypes=g([]);isSubmitting=g(!1);jobId=g(null);isEditMode=g(!1);mechanics=[{id:"mechanic-001",name:"Mohamed Trabelsi"},{id:"mechanic-002",name:"Ali Sassi"},{id:"mechanic-003",name:"Ahmed Bouzid"}];ngOnInit(){this.initializeForm(),this.loadData(),this.checkEditMode()}initializeForm(){this.maintenanceForm=this.fb.group({carId:["",d.required],mechanicId:["",d.required],jobTitle:["",d.required],description:["",d.required],priority:["medium",d.required],currentMileage:[0,[d.required,d.min(0)]],estimatedCost:[0,[d.min(0)]],estimatedDuration:[60,[d.min(5)]],notes:[""],tasks:this.fb.array([])})}loadData(){this.carService.getCars().subscribe({next:e=>this.cars.set(e),error:e=>console.error("Error loading cars:",e)}),this.maintenanceService.getServiceTypes().subscribe({next:e=>this.serviceTypes.set(e),error:e=>console.error("Error loading service types:",e)})}checkEditMode(){let e=this.route.snapshot.paramMap.get("id");e&&(this.jobId.set(e),this.isEditMode.set(!0),this.loadMaintenanceJob(e))}loadMaintenanceJob(e){this.maintenanceService.getMaintenanceJob(e).subscribe({next:n=>{n?this.populateForm(n):(console.error("Job not found"),this.goBack())},error:n=>{console.error("Error loading job:",n),this.goBack()}})}populateForm(e){this.maintenanceForm.patchValue({carId:e.carId,mechanicId:e.mechanicId,jobTitle:e.jobTitle,description:e.description,priority:e.priority,currentMileage:e.currentMileage,estimatedCost:e.estimatedCost,estimatedDuration:e.estimatedDuration,notes:e.notes});let n=this.tasks;n.clear(),e.tasks.forEach(a=>{n.push(this.createTaskFormGroup(a))})}get tasks(){return this.maintenanceForm.get("tasks")}addTask(){this.tasks.push(this.createTaskFormGroup())}removeTask(e){this.tasks.removeAt(e)}createTaskFormGroup(e){return this.fb.group({id:[e?.id||this.generateTaskId()],name:[e?.name||"",d.required],description:[e?.description||""],status:[e?.status||"pending"],estimatedTime:[e?.estimatedTime||30,[d.min(5),d.max(480)]],assignedMechanicId:[e?.assignedMechanicId||""]})}onSubmit(){if(this.maintenanceForm.valid){this.isSubmitting.set(!0);let e=this.maintenanceForm.value,n=this.cars().find(h=>h.id===e.carId),a=this.mechanics.find(h=>h.id===e.mechanicId),s=F(E({},e),{licensePlate:n?.licensePlate||"",customerName:"Customer Name",mechanicName:a?.name||"",carDetails:n?`${n.year} ${n.make} ${n.model}`:"",customerId:n?.customerId||"",photos:[],approvalRequests:[],status:"waiting"});(this.isEditMode()?this.maintenanceService.updateMaintenanceJob(this.jobId(),s):this.maintenanceService.createMaintenanceJob(s)).subscribe({next:()=>{this.isSubmitting.set(!1),this.goBack()},error:h=>{console.error("Error saving job:",h),this.isSubmitting.set(!1)}})}else this.markFormGroupTouched()}isFieldInvalid(e){let n=this.maintenanceForm.get(e);return!!(n&&n.invalid&&(n.dirty||n.touched))}markFormGroupTouched(){Object.keys(this.maintenanceForm.controls).forEach(e=>{this.maintenanceForm.get(e)?.markAsTouched()})}generateTaskId(){return"task-"+Math.random().toString(36).substr(2,9)}goBack(){this.router.navigate(["/maintenance/active"])}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=I({type:o,selectors:[["app-maintenance-form"]],decls:93,vars:23,consts:[[1,"p-6","max-w-4xl","mx-auto"],[1,"glass-card","mb-6"],[1,"flex","items-start","space-x-6"],[1,"p-3","text-gray-400","hover:text-white","transition-colors","bg-gray-800/50","rounded-lg","hover:bg-gray-700/50",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"flex-1"],[1,"text-3xl","lg:text-4xl","font-bold","text-white","mb-2"],[1,"bg-gray-800/30","rounded-lg","p-4","backdrop-filter","backdrop-blur-sm"],[1,"flex","items-center","space-x-3"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6","text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"text-lg","font-medium","text-blue-300"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"glass-card"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-300","mb-1"],["formControlName","carId",1,"form-select"],["value",""],[3,"value"],[1,"mt-1","text-sm","text-red-400"],["formControlName","mechanicId",1,"form-select"],["type","text","formControlName","jobTitle","placeholder","e.g., Brake Repair, Oil Change",1,"form-input"],["formControlName","priority",1,"form-select"],["value","low"],["value","medium"],["value","high"],["value","urgent"],["type","number","formControlName","currentMileage","placeholder","85000","min","0","max","999999",1,"form-input"],["type","number","formControlName","estimatedCost","placeholder","150","min","0","step","0.01",1,"form-input"],[1,"mt-4"],["formControlName","description","rows","3","placeholder","Describe the issue, symptoms, or maintenance required...",1,"form-textarea"],["formControlName","notes","rows","2","placeholder","Any additional information or special instructions...",1,"form-textarea"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],["type","button",1,"btn-secondary","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["formArrayName","tasks",1,"space-y-4"],[1,"p-4","border","border-gray-200","dark:border-gray-600","rounded-lg",3,"formGroupName"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","justify-end","space-x-4","pt-6"],["type","button",1,"btn-secondary",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["type","text","formControlName","name","placeholder","e.g., Replace brake pads",1,"form-input","text-sm"],["type","number","formControlName","estimatedTime","placeholder","60","min","5","max","480",1,"form-input","text-sm"],[1,"flex","items-end"],["type","button",1,"w-full","btn-danger","text-sm","py-2",3,"click"],[1,"mt-3"],["formControlName","description","rows","2","placeholder","Detailed description of what needs to be done...",1,"form-textarea","text-sm"],[1,"text-sm"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-2","h-4","w-4","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(n,a){n&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),x("click",function(){return a.goBack()}),v(),i(4,"svg",4),m(5,"path",5),t()(),C(),i(6,"div",6)(7,"h1",7),r(8),t(),i(9,"div",8)(10,"div",9),v(),i(11,"svg",10),m(12,"path",11),t(),C(),i(13,"p",12),r(14),t()()()()()(),i(15,"form",13),x("ngSubmit",function(){return a.onSubmit()}),i(16,"div",14)(17,"h2",15),r(18,"Basic Information"),t(),i(19,"div",16)(20,"div")(21,"label",17),r(22," Vehicle * "),t(),i(23,"select",18)(24,"option",19),r(25,"Select a vehicle"),t(),k(26,re,2,4,"option",20,ie),t(),c(28,ae,2,0,"p",21),t(),i(29,"div")(30,"label",17),r(31," Assigned Mechanic * "),t(),i(32,"select",22)(33,"option",19),r(34,"Select a mechanic"),t(),k(35,oe,2,2,"option",20,ie),t(),c(37,le,2,0,"p",21),t(),i(38,"div")(39,"label",17),r(40," Job Title * "),t(),m(41,"input",23),c(42,de,2,0,"p",21),t(),i(43,"div")(44,"label",17),r(45," Priority * "),t(),i(46,"select",24)(47,"option",25),r(48,"Low"),t(),i(49,"option",26),r(50,"Medium"),t(),i(51,"option",27),r(52,"High"),t(),i(53,"option",28),r(54,"Urgent"),t()()(),i(55,"div")(56,"label",17),r(57," Current Mileage (km) * "),t(),m(58,"input",29),c(59,me,2,0,"p",21),t(),i(60,"div")(61,"label",17),r(62," Estimated Cost (TND) "),t(),m(63,"input",30),t()(),i(64,"div",31)(65,"label",17),r(66," Description * "),t(),i(67,"textarea",32),r(68,"            "),t(),c(69,se,2,0,"p",21),t(),i(70,"div",31)(71,"label",17),r(72," Additional Notes "),t(),i(73,"textarea",33),r(74,"            "),t()()(),i(75,"div",14)(76,"div",34)(77,"h2",35),r(78,"Tasks"),t(),i(79,"button",36),x("click",function(){return a.addTask()}),v(),i(80,"svg",37),m(81,"path",38),t(),r(82," Add Task "),t()(),C(),i(83,"div",39),k(84,ce,18,1,"div",40,N),t(),c(86,pe,3,0,"div",41),t(),i(87,"div",42)(88,"button",43),x("click",function(){return a.goBack()}),r(89," Cancel "),t(),i(90,"button",44),c(91,ue,4,0)(92,be,1,1),t()()()()),n&2&&(l(8),_(" ",a.isEditMode()?"Edit Maintenance Job":"New Maintenance Job"," "),l(6),_(" ",a.isEditMode()?"Update job details and tasks":"Create a new maintenance or repair job"," "),l(),f("formGroup",a.maintenanceForm),l(8),u("border-red-500",a.isFieldInvalid("carId")),l(3),M(a.cars()),l(2),p(a.isFieldInvalid("carId")?28:-1),l(4),u("border-red-500",a.isFieldInvalid("mechanicId")),l(3),M(a.mechanics),l(2),p(a.isFieldInvalid("mechanicId")?37:-1),l(4),u("border-red-500",a.isFieldInvalid("jobTitle")),l(),p(a.isFieldInvalid("jobTitle")?42:-1),l(4),u("border-red-500",a.isFieldInvalid("priority")),l(12),u("border-red-500",a.isFieldInvalid("currentMileage")),l(),p(a.isFieldInvalid("currentMileage")?59:-1),l(8),u("border-red-500",a.isFieldInvalid("description")),l(2),p(a.isFieldInvalid("description")?69:-1),l(15),M(a.tasks.controls),l(2),p(a.tasks.length===0?86:-1),l(4),f("disabled",a.maintenanceForm.invalid||a.isSubmitting()),l(),p(a.isSubmitting()?91:92))},dependencies:[A,Z,q,U,K,B,z,Y,J,j,W,Q,$,L,H,R],styles:[".glass-card[_ngcontent-%COMP%]{background:#111827f2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(75,85,99,.6);border-radius:20px;padding:1.5rem;box-shadow:0 8px 32px #000000b3;transition:all .3s cubic-bezier(.4,0,.2,1);margin-bottom:1rem}.glass-card[_ngcontent-%COMP%]:hover{background:#1f2937fa;box-shadow:0 12px 40px #000c;border-color:#3b82f6b3;transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#059669,#047857);border:1px solid #059669;color:#fff!important;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #0596694d}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#047857,#065f46);box-shadow:0 6px 20px #05966966;transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6cc,#1d4ed8cc);border:1px solid rgba(59,130,246,.6);color:#fff;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #3b82f64d}.btn-secondary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3b82f6e6,#1d4ed8e6);box-shadow:0 6px 20px #3b82f666;transform:translateY(-1px)}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc2626,#991b1b);border:1px solid #dc2626;color:#fff!important;padding:.75rem 1rem;border-radius:12px;font-size:.875rem;font-weight:600;transition:all .3s cubic-bezier(.4,0,.2,1);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:inline-flex;align-items:center;justify-content:center;gap:.5rem;cursor:pointer;box-shadow:0 4px 15px #dc26264d}.btn-danger[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#991b1b,#7f1d1d);box-shadow:0 6px 20px #dc262666;transform:translateY(-1px)}.glass-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-900[_ngcontent-%COMP%]{color:#fff!important}.glass-card[_ngcontent-%COMP%]   .text-gray-500[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-400[_ngcontent-%COMP%]{color:#9ca3af!important}.glass-card[_ngcontent-%COMP%]   .text-gray-700[_ngcontent-%COMP%], .glass-card[_ngcontent-%COMP%]   .text-gray-600[_ngcontent-%COMP%]{color:#d1d5db!important}"]})};export{ne as MaintenanceFormComponent};
