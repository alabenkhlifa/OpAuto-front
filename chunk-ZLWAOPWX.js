import{C as o,M as n,P as h,j as c,m as a,n as s}from"./chunk-BYA6T2VX.js";var E={admin:"Admin",mechanic:"Mechanic",receptionist:"Receptionist"},i={INVALID_CREDENTIALS:"Invalid email or password",EMAIL_ALREADY_EXISTS:"An account with this email already exists",EMAIL_NOT_FOUND:"No account found with this email address",WEAK_PASSWORD:"Password must be at least 8 characters with uppercase, lowercase, and numbers",INVALID_EMAIL:"Please enter a valid email address",ACCOUNT_LOCKED:"Account has been locked due to too many failed login attempts",SESSION_EXPIRED:"Your session has expired. Please log in again",NETWORK_ERROR:"Network error. Please check your connection and try again",SERVER_ERROR:"Server error. Please try again later"};var g=class u{STORAGE_KEYS={TOKEN:"opauth_token",REFRESH_TOKEN:"opauth_refresh_token",USER:"opauth_user",REMEMBER_ME:"opauth_remember_me"};currentUserSubject=new c(null);currentUser$=this.currentUserSubject.asObservable();isAuthenticatedSubject=new c(!1);isAuthenticated$=this.isAuthenticatedSubject.asObservable();constructor(){this.clearAuthData(),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}login(e){return this.validateLoginCredentials(e).pipe(o(1500),n(t=>{this.storeAuthData(t,e.rememberMe),this.currentUserSubject.next(t.user),this.isAuthenticatedSubject.next(!0)}))}register(e){return this.validateRegistrationData(e).pipe(o(2e3),n(t=>{this.storeAuthData(t,!1),this.currentUserSubject.next(t.user),this.isAuthenticatedSubject.next(!0)}))}logout(){return a(!0).pipe(o(300),n(()=>{this.clearAuthData(),this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1)}))}forgotPassword(e){return["admin@example.com","mechanic@example.com"].includes(e.email)?a({message:"Password reset instructions sent to your email"}).pipe(o(1e3)):s(()=>({code:"EMAIL_NOT_FOUND",message:i.EMAIL_NOT_FOUND}))}resetPassword(e){return e.password!==e.confirmPassword?s(()=>({code:"PASSWORDS_DONT_MATCH",message:"Passwords do not match"})):a({message:"Password reset successfully"}).pipe(o(1e3))}changePassword(e){return e.newPassword!==e.confirmPassword?s(()=>({code:"PASSWORDS_DONT_MATCH",message:"New passwords do not match"})):e.currentPassword==="wrongpassword"?s(()=>({code:"INVALID_CURRENT_PASSWORD",message:"Current password is incorrect"})):a({message:"Password changed successfully"}).pipe(o(1e3))}refreshToken(){if(!localStorage.getItem(this.STORAGE_KEYS.REFRESH_TOKEN))return s(()=>({code:"NO_REFRESH_TOKEN",message:"No refresh token available"}));let t=this.currentUserSubject.value;if(!t)return s(()=>({code:"NO_USER",message:"No user data available"}));let r={user:t,token:`mock_token_${Date.now()}`,refreshToken:`mock_refresh_${Date.now()}`,expiresIn:3600};return a(r).pipe(o(500),n(l=>{this.storeAuthData(l,!0)}))}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){return this.isAuthenticatedSubject.value}hasRole(e){let t=this.getCurrentUser();return t?t.role===e:!1}isAdmin(){return this.hasRole("admin")}validateLoginCredentials(e){let r=[{email:"admin@opauto.tn",password:"admin123",name:"Ahmed Ben Salah",role:"admin",garageName:"OpAuto Garage Tunis"},{email:"mechanic@opauto.tn",password:"mech123",name:"Fatma Slimani",role:"mechanic",garageName:"OpAuto Garage Tunis"}].find(m=>m.email===e.email&&m.password===e.password);if(!r)return s(()=>({code:"INVALID_CREDENTIALS",message:i.INVALID_CREDENTIALS}));let d={user:{id:`user_${Date.now()}`,email:r.email,name:r.name,role:r.role,garageName:r.garageName,isActive:!0,createdAt:new Date("2024-01-01"),updatedAt:new Date,lastLogin:new Date,preferences:{theme:"system",language:"en",notifications:{email:!0,sms:!1,browser:!0},dashboardLayout:"standard"}},token:`mock_token_${Date.now()}`,refreshToken:`mock_refresh_${Date.now()}`,expiresIn:3600};return a(d)}validateRegistrationData(e){if(e.email==="admin@opauto.tn")return s(()=>({code:"EMAIL_ALREADY_EXISTS",message:i.EMAIL_ALREADY_EXISTS}));if(e.password!==e.confirmPassword)return s(()=>({code:"PASSWORDS_DONT_MATCH",message:"Passwords do not match"}));if(!e.acceptTerms)return s(()=>({code:"TERMS_NOT_ACCEPTED",message:"You must accept the terms and conditions"}));let r={user:{id:`user_${Date.now()}`,email:e.email,name:e.name,role:"admin",garageName:e.garageName,phoneNumber:e.phoneNumber,isActive:!0,createdAt:new Date,updatedAt:new Date,preferences:{theme:"system",language:"en",notifications:{email:!0,sms:!1,browser:!0},dashboardLayout:"standard"}},token:`mock_token_${Date.now()}`,refreshToken:`mock_refresh_${Date.now()}`,expiresIn:3600};return a(r)}storeAuthData(e,t){let r=t?localStorage:sessionStorage;r.setItem(this.STORAGE_KEYS.TOKEN,e.token),r.setItem(this.STORAGE_KEYS.REFRESH_TOKEN,e.refreshToken),r.setItem(this.STORAGE_KEYS.USER,JSON.stringify(e.user)),t&&localStorage.setItem(this.STORAGE_KEYS.REMEMBER_ME,"true")}clearAuthData(){[localStorage,sessionStorage].forEach(e=>{Object.values(this.STORAGE_KEYS).forEach(t=>{e.removeItem(t)})})}getUserFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEYS.USER);return e||(e=sessionStorage.getItem(this.STORAGE_KEYS.USER)),e?JSON.parse(e):null}catch{return null}}hasValidToken(){return!!(localStorage.getItem(this.STORAGE_KEYS.TOKEN)||sessionStorage.getItem(this.STORAGE_KEYS.TOKEN))}checkTokenExpiration(){(localStorage.getItem(this.STORAGE_KEYS.TOKEN)||sessionStorage.getItem(this.STORAGE_KEYS.TOKEN))&&!this.getUserFromStorage()&&(this.clearAuthData(),this.isAuthenticatedSubject.next(!1))}static \u0275fac=function(t){return new(t||u)};static \u0275prov=h({token:u,factory:u.\u0275fac,providedIn:"root"})};export{E as a,g as b};
