import{C as b,P as T,ga as m,j as f,m as d,q as n}from"./chunk-BYA6T2VX.js";var y=class p{mockTiers=[{id:"solo",name:"Solo",price:500,currency:"TND",features:[{key:"single_user",enabled:!0},{key:"basic_appointments",enabled:!0},{key:"cash_invoicing",enabled:!0},{key:"basic_reports",enabled:!0},{key:"browser_notifications",enabled:!0},{key:"multi_user",enabled:!1,requiresUpgrade:"starter"},{key:"email_notifications",enabled:!1,requiresUpgrade:"starter"},{key:"internal_approvals",enabled:!1,requiresUpgrade:"starter"},{key:"photos_documentation",enabled:!1,requiresUpgrade:"professional"},{key:"inventory_management",enabled:!1,requiresUpgrade:"professional"}],limits:{users:1,cars:50,serviceBays:2}},{id:"starter",name:"Starter",price:2e3,currency:"TND",features:[{key:"multi_user",enabled:!0},{key:"appointment_management",enabled:!0},{key:"cash_invoicing",enabled:!0},{key:"basic_reports",enabled:!0},{key:"email_notifications",enabled:!0},{key:"internal_approvals",enabled:!0},{key:"photos_documentation",enabled:!1,requiresUpgrade:"professional"},{key:"inventory_management",enabled:!1,requiresUpgrade:"professional"},{key:"sms_notifications",enabled:!1,requiresUpgrade:"professional"},{key:"priority_support",enabled:!1,requiresUpgrade:"professional"}],limits:{users:3,cars:200,serviceBays:2},popular:!0},{id:"professional",name:"Professional",price:6e3,currency:"TND",features:[{key:"unlimited_users",enabled:!0},{key:"appointment_management",enabled:!0},{key:"cash_invoicing",enabled:!0},{key:"basic_reports",enabled:!0},{key:"email_notifications",enabled:!0},{key:"internal_approvals",enabled:!0},{key:"photos_documentation",enabled:!0},{key:"inventory_management",enabled:!0},{key:"sms_notifications",enabled:!0},{key:"priority_support",enabled:!0},{key:"advanced_reports",enabled:!0},{key:"data_export",enabled:!0}],limits:{users:null,cars:null,serviceBays:null}}];mockUsage={users:3,cars:47,serviceBays:2};currentTierSubject=new f("starter");loadingSubject=new f(!1);isLoading=m(!1);currentTier=m("starter");constructor(){}getTiers(){return this.setLoading(!0),d(this.mockTiers).pipe(b(500),n(e=>(this.setLoading(!1),e)))}getCurrentSubscriptionStatus(){this.setLoading(!0);let e=this.currentTierSubject.value,r=this.mockTiers.find(s=>s.id===e),t=new Date;t.setMonth(t.getMonth()+1);let i=Math.ceil((t.getTime()-new Date().getTime())/(1e3*60*60*24)),o={currentTier:r,usage:this.mockUsage,renewalDate:t,isActive:!0,daysUntilRenewal:i};return d(o).pipe(b(300),n(s=>(this.setLoading(!1),s)))}getTierComparison(){let e=this.currentTierSubject.value,r;e==="solo"&&this.mockUsage.users>1?r="starter":e==="starter"&&this.mockUsage.users>5&&(r="professional");let t={tiers:this.mockTiers,currentTierId:e,recommendedTierId:r};return d(t).pipe(b(200))}isFeatureEnabled(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>r.currentTier.features.find(i=>i.key===e)?.enabled||!1))}hasFeature(e){return this.isFeatureEnabled(e)}getRequiredTier(e){for(let r of this.mockTiers){let t=r.features.find(i=>i.key===e);if(t&&t.enabled)return r.id}return null}getUpgradeTierForFeature(e){let r=this.currentTierSubject.value,t=this.mockTiers.find(o=>o.id===r);return t&&t.features.find(o=>o.key===e)?.requiresUpgrade||null}isUsageLimitExceeded(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>{let t=r.currentTier.limits[e],i=r.usage[e];return t===null?!1:i>=t}))}getLockedFeatures(){return this.getCurrentSubscriptionStatus().pipe(n(e=>e.currentTier.features.filter(r=>!r.enabled)))}canUpgradeTo(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>{let t=["solo","starter","professional"],i=t.indexOf(r.currentTier.id);return t.indexOf(e)>i}))}canDowngradeTo(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>{let t=["solo","starter","professional"],i=t.indexOf(r.currentTier.id);if(t.indexOf(e)>=i)return{canDowngrade:!1,reasons:["subscription.errors.invalid_downgrade"]};let s=this.mockTiers.find(a=>a.id===e),u=r.usage,c=[];s.limits.users!==null&&u.users>s.limits.users&&c.push("subscription.downgrade.blocked.users_exceed_limit"),s.limits.cars!==null&&u.cars>s.limits.cars&&c.push("subscription.downgrade.blocked.cars_exceed_limit"),s.limits.serviceBays!==null&&u.serviceBays>s.limits.serviceBays&&c.push("subscription.downgrade.blocked.service_bays_exceed_limit");let l=r.currentTier.features.filter(a=>a.enabled).map(a=>a.key),g=s.features.filter(a=>a.enabled).map(a=>a.key);return l.filter(a=>!g.includes(a)).length>0&&c.push("subscription.downgrade.blocked.features_in_use"),{canDowngrade:c.length===0,reasons:c}}))}canChangeTo(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>{let t=["solo","starter","professional"],i=t.indexOf(r.currentTier.id),o=t.indexOf(e);if(o===i)return{canChange:!1,reasons:["subscription.errors.same_tier"],isUpgrade:!1};if(o>i)return{canChange:!0,reasons:[],isUpgrade:!0};{let u=this.mockTiers.find(g=>g.id===e),c=r.usage,l=[];return u.limits.users!==null&&c.users>u.limits.users&&l.push("subscription.downgrade.blocked.users_exceed_limit"),u.limits.cars!==null&&c.cars>u.limits.cars&&l.push("subscription.downgrade.blocked.cars_exceed_limit"),u.limits.serviceBays!==null&&c.serviceBays>u.limits.serviceBays&&l.push("subscription.downgrade.blocked.service_bays_exceed_limit"),{canChange:l.length===0,reasons:l,isUpgrade:!1}}}))}getUsagePercentage(e){return this.getCurrentSubscriptionStatus().pipe(n(r=>{let t=r.usage[e],i=r.currentTier.limits[e];return i===null?0:i===0?100:Math.min(t/i*100,100)}))}upgradeTo(e){return this.setLoading(!0),d(!0).pipe(b(1e3),n(r=>(r&&(this.currentTierSubject.next(e),this.currentTier.set(e)),this.setLoading(!1),r)))}getRecommendedTier(){return this.getTierComparison().pipe(n(e=>e.recommendedTierId&&this.mockTiers.find(r=>r.id===e.recommendedTierId)||null))}setLoading(e){this.isLoading.set(e),this.loadingSubject.next(e)}get loading$(){return this.loadingSubject.asObservable()}get currentTier$(){return this.currentTierSubject.asObservable()}static \u0275fac=function(r){return new(r||p)};static \u0275prov=T({token:p,factory:p.\u0275fac,providedIn:"root"})};export{y as a};
