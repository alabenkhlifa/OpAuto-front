import{a as h}from"./chunk-N2UVJJWA.js";import{b as l}from"./chunk-KSNCH7NH.js";import{a as g}from"./chunk-UJO3757W.js";import{P as p,U as s,a,b as d,ga as c,j as u}from"./chunk-DMTVNCDT.js";var o={SOLO_OWNER:"solo-owner-tour",STARTER_OWNER:"starter-owner-tour",STARTER_STAFF:"starter-staff-tour",PROFESSIONAL_OWNER:"professional-owner-tour",PROFESSIONAL_STAFF:"professional-staff-tour",FEATURE_INVENTORY:"feature-inventory-tour",FEATURE_REPORTS:"feature-reports-tour",FEATURE_APPROVALS:"feature-approvals-tour",UPGRADE_WHATS_NEW:"upgrade-whats-new-tour"};var f=class n{authService=s(l);subscriptionService=s(g);sidebarService=s(h);STORAGE_KEY="opauth_onboarding_progress";tourStateSubject=new u({isActive:!1,currentStepIndex:0,totalSteps:0});tourState$=this.tourStateSubject.asObservable();currentStep=c(null);tourConfigs=new Map;constructor(){this.initializeTourConfigs()}initializeTourConfigs(){this.tourConfigs.set(o.SOLO_OWNER,{id:o.SOLO_OWNER,tier:"solo",role:"owner",steps:[{id:"welcome",target:"body",title:"onboarding.solo.welcome.title",description:"onboarding.solo.welcome.description",placement:"center",order:1,showNext:!0,showSkip:!0},{id:"dashboard-overview",target:".dashboard-metrics",title:"onboarding.solo.dashboard.title",description:"onboarding.solo.dashboard.description",placement:"bottom",order:2,showNext:!0,showPrevious:!0,showSkip:!0},{id:"add-car",target:'[data-tour="add-car"]',title:"onboarding.solo.addCar.title",description:"onboarding.solo.addCar.description",placement:"bottom",order:3,action:{type:"navigate",route:"/cars"},showNext:!0,showPrevious:!0,showSkip:!0},{id:"maintenance",target:'[data-tour="maintenance"]',title:"onboarding.solo.maintenance.title",description:"onboarding.solo.maintenance.description",placement:"bottom",order:4,showNext:!0,showPrevious:!0,showSkip:!0},{id:"invoicing",target:'[data-tour="invoices"]',title:"onboarding.solo.invoicing.title",description:"onboarding.solo.invoicing.description",placement:"right",order:5,showNext:!0,showPrevious:!0,showSkip:!0},{id:"notifications",target:'[data-tour="notifications"]',title:"onboarding.solo.notifications.title",description:"onboarding.solo.notifications.description",placement:"bottom",order:6,showNext:!0,showPrevious:!0,showSkip:!0},{id:"upgrade-prompt",target:".subscription-card",title:"onboarding.solo.upgrade.title",description:"onboarding.solo.upgrade.description",placement:"center",order:7,showPrevious:!0}]}),this.tourConfigs.set(o.STARTER_OWNER,{id:o.STARTER_OWNER,tier:"starter",role:"owner",steps:[{id:"welcome",target:"body",title:"onboarding.starter.welcome.title",description:"onboarding.starter.welcome.description",placement:"center",order:1,showNext:!0,showSkip:!0},{id:"dashboard",target:".dashboard-metrics",title:"onboarding.starter.dashboard.title",description:"onboarding.starter.dashboard.description",placement:"bottom",order:2,showNext:!0,showPrevious:!0,showSkip:!0},{id:"multi-user",target:'[data-tour="employees"]',title:"onboarding.starter.multiUser.title",description:"onboarding.starter.multiUser.description",placement:"right",order:3,showNext:!0,showPrevious:!0,showSkip:!0},{id:"approvals",target:'[data-tour="approvals"]',title:"onboarding.starter.approvals.title",description:"onboarding.starter.approvals.description",placement:"right",order:4,showNext:!0,showPrevious:!0,showSkip:!0},{id:"email-notifications",target:'[data-tour="settings"]',title:"onboarding.starter.emailNotifications.title",description:"onboarding.starter.emailNotifications.description",placement:"right",order:5,showNext:!0,showPrevious:!0,showSkip:!0},{id:"customer-history",target:'[data-tour="customers"]',title:"onboarding.starter.customerHistory.title",description:"onboarding.starter.customerHistory.description",placement:"right",order:6,showNext:!0,showPrevious:!0,showSkip:!0},{id:"reports",target:'[data-tour="reports"]',title:"onboarding.starter.reports.title",description:"onboarding.starter.reports.description",placement:"right",order:7,showNext:!0,showPrevious:!0,showSkip:!0},{id:"upgrade-pro",target:".subscription-card",title:"onboarding.starter.upgradePro.title",description:"onboarding.starter.upgradePro.description",placement:"center",order:8,showPrevious:!0}]}),this.tourConfigs.set(o.STARTER_STAFF,{id:o.STARTER_STAFF,tier:"starter",role:"staff",steps:[{id:"welcome-staff",target:"body",title:"onboarding.staff.welcome.title",description:"onboarding.staff.welcome.description",placement:"center",order:1,showNext:!0,showSkip:!0},{id:"dashboard-staff",target:".dashboard-metrics",title:"onboarding.staff.dashboard.title",description:"onboarding.staff.dashboard.description",placement:"bottom",order:2,showNext:!0,showPrevious:!0,showSkip:!0},{id:"maintenance-staff",target:'[data-tour="maintenance"]',title:"onboarding.staff.maintenance.title",description:"onboarding.staff.maintenance.description",placement:"bottom",order:3,showNext:!0,showPrevious:!0,showSkip:!0},{id:"approvals-request",target:".approval-button",title:"onboarding.staff.approvalRequest.title",description:"onboarding.staff.approvalRequest.description",placement:"bottom",order:4,showNext:!0,showPrevious:!0,showSkip:!0},{id:"profile-staff",target:'[data-tour="profile"]',title:"onboarding.staff.profile.title",description:"onboarding.staff.profile.description",placement:"left",order:5,showPrevious:!0}]}),this.tourConfigs.set(o.PROFESSIONAL_OWNER,{id:o.PROFESSIONAL_OWNER,tier:"professional",role:"owner",steps:[{id:"welcome-pro",target:"body",title:"onboarding.professional.welcome.title",description:"onboarding.professional.welcome.description",placement:"center",order:1,showNext:!0,showSkip:!0},{id:"dashboard-pro",target:".dashboard-metrics",title:"onboarding.professional.dashboard.title",description:"onboarding.professional.dashboard.description",placement:"bottom",order:2,showNext:!0,showPrevious:!0,showSkip:!0},{id:"inventory",target:'[data-tour="inventory"]',title:"onboarding.professional.inventory.title",description:"onboarding.professional.inventory.description",placement:"right",order:3,showNext:!0,showPrevious:!0,showSkip:!0},{id:"photo-docs",target:".photo-upload",title:"onboarding.professional.photoDocs.title",description:"onboarding.professional.photoDocs.description",placement:"top",order:4,showNext:!0,showPrevious:!0,showSkip:!0},{id:"advanced-reports",target:'[data-tour="reports"]',title:"onboarding.professional.advancedReports.title",description:"onboarding.professional.advancedReports.description",placement:"right",order:5,showNext:!0,showPrevious:!0,showSkip:!0},{id:"sms-notifications",target:'[data-tour="settings"]',title:"onboarding.professional.smsNotifications.title",description:"onboarding.professional.smsNotifications.description",placement:"right",order:6,showNext:!0,showPrevious:!0,showSkip:!0},{id:"data-export",target:".export-button",title:"onboarding.professional.dataExport.title",description:"onboarding.professional.dataExport.description",placement:"bottom",order:7,showNext:!0,showPrevious:!0,showSkip:!0},{id:"unlimited-features",target:"body",title:"onboarding.professional.unlimitedFeatures.title",description:"onboarding.professional.unlimitedFeatures.description",placement:"center",order:8,showPrevious:!0}]}),this.tourConfigs.set(o.PROFESSIONAL_STAFF,{id:o.PROFESSIONAL_STAFF,tier:"professional",role:"staff",steps:[{id:"welcome-staff-pro",target:"body",title:"onboarding.staff.welcome.title",description:"onboarding.staff.welcome.description",placement:"center",order:1,showNext:!0,showSkip:!0},{id:"dashboard-staff-pro",target:".dashboard-metrics",title:"onboarding.staff.dashboard.title",description:"onboarding.staff.dashboard.description",placement:"bottom",order:2,showNext:!0,showPrevious:!0,showSkip:!0},{id:"maintenance-staff-pro",target:'[data-tour="maintenance"]',title:"onboarding.staff.maintenance.title",description:"onboarding.staff.maintenance.description",placement:"bottom",order:3,showNext:!0,showPrevious:!0,showSkip:!0},{id:"photo-staff",target:".photo-upload",title:"onboarding.staff.photoUpload.title",description:"onboarding.staff.photoUpload.description",placement:"top",order:4,showNext:!0,showPrevious:!0,showSkip:!0},{id:"profile-staff-pro",target:'[data-tour="profile"]',title:"onboarding.staff.profile.title",description:"onboarding.staff.profile.description",placement:"left",order:5,showPrevious:!0}]})}startTourForCurrentUser(){let t=this.authService.getCurrentUser();if(!t)return;let e=this.subscriptionService.currentTier(),r=t.role,i=this.getTourIdForUser(e,r);i&&this.startTour(i)}startTour(t){let e=this.tourConfigs.get(t);if(!e){console.error(`Tour config not found for: ${t}`);return}let r=this.getProgress();if(r.completedTours.includes(t)||r.dismissedTours.includes(t))return;this.isMobile()&&this.sidebarService.closeMobileMenu();let i=r.currentTour===t&&r.currentStep||0;this.tourStateSubject.next({isActive:!0,currentTour:e,currentStepIndex:i,totalSteps:e.steps.length}),this.currentStep.set(e.steps[i]),this.saveProgress({currentTour:t,currentStep:i})}nextStep(){let t=this.tourStateSubject.value;if(!t.currentTour||!t.isActive)return;let e=t.currentStepIndex+1;if(e>=t.currentTour.steps.length){this.completeTour();return}let r=t.currentTour.steps[t.currentStepIndex],i=t.currentTour.steps[e];this.isMobile()&&r.id==="add-car"&&i&&this.sidebarService.openMobileMenu(),this.tourStateSubject.next(d(a({},t),{currentStepIndex:e})),this.currentStep.set(t.currentTour.steps[e]),this.saveProgress({currentTour:t.currentTour.id,currentStep:e})}previousStep(){let t=this.tourStateSubject.value;if(!t.currentTour||!t.isActive||t.currentStepIndex===0)return;let e=t.currentStepIndex-1,r=t.currentTour.steps[e];this.isMobile()&&r.id==="add-car"&&this.sidebarService.closeMobileMenu(),this.tourStateSubject.next(d(a({},t),{currentStepIndex:e})),this.currentStep.set(t.currentTour.steps[e]),this.saveProgress({currentTour:t.currentTour.id,currentStep:e})}skipTour(){let t=this.tourStateSubject.value;if(!t.currentTour)return;let e=this.getProgress();e.dismissedTours.push(t.currentTour.id),e.currentTour=void 0,e.currentStep=void 0,e.lastUpdated=new Date,this.saveProgressToStorage(e),this.endTour(),this.isMobile()&&this.sidebarService.closeMobileMenu()}completeTour(){let t=this.tourStateSubject.value;if(!t.currentTour)return;let e=this.getProgress();e.completedTours.includes(t.currentTour.id)||e.completedTours.push(t.currentTour.id),e.currentTour=void 0,e.currentStep=void 0,e.lastUpdated=new Date,this.saveProgressToStorage(e),this.endTour(),this.isMobile()&&this.sidebarService.closeMobileMenu()}restartTour(t){let e=this.getProgress();e.completedTours=e.completedTours.filter(r=>r!==t),e.dismissedTours=e.dismissedTours.filter(r=>r!==t),e.currentTour=void 0,e.currentStep=void 0,this.saveProgressToStorage(e),this.startTour(t)}isTourCompleted(t){return this.getProgress().completedTours.includes(t)}isTourDismissed(t){return this.getProgress().dismissedTours.includes(t)}shouldShowTour(t){return!this.isTourCompleted(t)&&!this.isTourDismissed(t)}getTourConfig(t){return this.tourConfigs.get(t)}getTourIdForUser(t,e){if(e==="staff")return t==="solo"?null:t==="starter"?o.STARTER_STAFF:o.PROFESSIONAL_STAFF;switch(t){case"solo":return o.SOLO_OWNER;case"starter":return o.STARTER_OWNER;case"professional":return o.PROFESSIONAL_OWNER;default:return null}}endTour(){this.tourStateSubject.next({isActive:!1,currentStepIndex:0,totalSteps:0}),this.currentStep.set(null)}getProgress(){try{let t=this.authService.getCurrentUser();if(!t)return this.getDefaultProgress();let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return this.getDefaultProgress();let r=JSON.parse(e);return r.userId!==t.id?this.getDefaultProgress():r}catch(t){return console.error("Error loading onboarding progress:",t),this.getDefaultProgress()}}saveProgress(t){let e=this.getProgress();Object.assign(e,t),e.lastUpdated=new Date,this.saveProgressToStorage(e)}saveProgressToStorage(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Error saving onboarding progress:",e)}}getDefaultProgress(){return{userId:this.authService.getCurrentUser()?.id||"",completedTours:[],dismissedTours:[],lastUpdated:new Date}}resetAllProgress(){localStorage.removeItem(this.STORAGE_KEY),this.endTour()}isMobile(){return typeof window<"u"&&window.innerWidth<1024}static \u0275fac=function(e){return new(e||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{o as a,f as b};
