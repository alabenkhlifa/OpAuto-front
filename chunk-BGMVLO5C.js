import{P as D,a as u,b as l,ga as J,j as w,m as p,q as m}from"./chunk-DMTVNCDT.js";var f=class h{maintenanceJobsSubject=new w([]);maintenanceJobs$=this.maintenanceJobsSubject.asObservable();selectedJob=J(null);filters=J({});mockMaintenanceJobs=[{id:"mj-001",carId:"car-001",customerId:"customer-001",mechanicId:"mechanic-001",licensePlate:"123 TN 1234",customerName:"Ahmed Ben Ali",mechanicName:"Mohamed Trabelsi",carDetails:"2019 Toyota Corolla",currentMileage:85e3,jobTitle:"Brake System Repair",description:"Customer reported squeaking noise and reduced braking performance",tasks:[{id:"task-001",name:"Inspect brake pads",description:"Check front and rear brake pad thickness",status:"completed",estimatedTime:30,actualTime:25,assignedMechanicId:"mechanic-001",completedAt:new Date(2025,7,29,9,30)},{id:"task-002",name:"Replace front brake pads",description:"Install new ceramic brake pads",status:"in-progress",estimatedTime:60,assignedMechanicId:"mechanic-001"},{id:"task-003",name:"Test brake system",description:"Road test to verify proper brake function",status:"pending",estimatedTime:15}],photos:[{id:"photo-001",url:"/assets/maintenance/brake-pads-worn.jpg",filename:"brake-pads-worn.jpg",description:"Worn front brake pads",category:"before",uploadedAt:new Date(2025,7,29,9,0),uploadedBy:"mechanic-001"}],status:"in-progress",priority:"high",estimatedCost:180,estimatedDuration:105,startDate:new Date(2025,7,29,9,0),approvalRequests:[],notes:"Customer will wait during repair",createdAt:new Date(2025,7,29,8,30),updatedAt:new Date(2025,7,29,10,15)},{id:"mj-002",carId:"car-002",customerId:"customer-002",mechanicId:"mechanic-002",licensePlate:"456 TN 7890",customerName:"Fatma Habibi",mechanicName:"Ali Sassi",carDetails:"2021 Renault Megane",currentMileage:42e3,jobTitle:"Regular Oil Change Service",description:"Routine maintenance - oil and filter change",tasks:[{id:"task-004",name:"Drain old oil",description:"Remove old engine oil",status:"completed",estimatedTime:15,actualTime:12,assignedMechanicId:"mechanic-002",completedAt:new Date(2025,7,30,8,45)},{id:"task-005",name:"Replace oil filter",description:"Install new oil filter",status:"completed",estimatedTime:10,actualTime:8,assignedMechanicId:"mechanic-002",completedAt:new Date(2025,7,30,8,55)},{id:"task-006",name:"Add new oil",description:"Fill with 5W-30 synthetic oil",status:"completed",estimatedTime:10,actualTime:10,assignedMechanicId:"mechanic-002",completedAt:new Date(2025,7,30,9,5)}],photos:[],status:"completed",priority:"medium",estimatedCost:75,actualCost:75,estimatedDuration:35,actualDuration:30,startDate:new Date(2025,7,30,8,30),completionDate:new Date(2025,7,30,9,0),approvalRequests:[],notes:"Service completed on time",createdAt:new Date(2025,7,30,8,0),updatedAt:new Date(2025,7,30,9,10)},{id:"mj-003",carId:"car-003",customerId:"customer-003",mechanicId:"mechanic-001",licensePlate:"789 TN 2468",customerName:"Karim Bouaziz",mechanicName:"Mohamed Trabelsi",carDetails:"2018 Peugeot 208",currentMileage:95e3,jobTitle:"Engine Diagnostic",description:"Check engine light on, irregular idle",tasks:[{id:"task-007",name:"OBD scan",description:"Run diagnostic scan for error codes",status:"pending",estimatedTime:20},{id:"task-008",name:"Inspect ignition system",description:"Check spark plugs and coils",status:"pending",estimatedTime:45}],photos:[],status:"waiting-approval",priority:"medium",estimatedCost:150,estimatedDuration:65,approvalRequests:[{id:"approval-001",type:"additional-work",description:"Replace spark plugs - showing excessive wear",estimatedPrice:120,urgency:"medium",requestedBy:"mechanic-001",requestedAt:new Date(2025,7,30,11,0),status:"pending"}],notes:"Waiting for customer approval on additional work",createdAt:new Date(2025,7,30,10,30),updatedAt:new Date(2025,7,30,11,0)}];mockServiceTypes=[{id:"oil-change",name:"Oil Change",category:"routine-maintenance",estimatedDuration:30,estimatedCost:75,description:"Engine oil and filter replacement",requiredSkills:["basic-maintenance"],commonParts:["engine-oil","oil-filter"]},{id:"brake-repair",name:"Brake Repair",category:"brakes",estimatedDuration:120,estimatedCost:200,description:"Brake pad and disc service",requiredSkills:["brake-systems"],commonParts:["brake-pads","brake-discs","brake-fluid"]},{id:"engine-diagnostic",name:"Engine Diagnostic",category:"diagnostics",estimatedDuration:60,estimatedCost:100,description:"Comprehensive engine analysis",requiredSkills:["diagnostics","engine-systems"],commonParts:[]}];constructor(){this.maintenanceJobsSubject.next(this.mockMaintenanceJobs)}getMaintenanceJobs(e){return this.maintenanceJobs$.pipe(m(a=>this.applyFilters(a,e)))}getMaintenanceJob(e){return this.maintenanceJobs$.pipe(m(a=>a.find(t=>t.id===e)||null))}createMaintenanceJob(e){let a={id:this.generateId(),carId:e.carId,customerId:e.customerId,mechanicId:e.mechanicId,licensePlate:e.licensePlate,customerName:e.customerName,mechanicName:e.mechanicName,carDetails:e.carDetails,currentMileage:e.currentMileage,jobTitle:e.jobTitle,description:e.description,tasks:e.tasks||[],photos:e.photos||[],status:e.status||"waiting",priority:e.priority||"medium",estimatedCost:e.estimatedCost||0,estimatedDuration:e.estimatedDuration||60,approvalRequests:e.approvalRequests||[],notes:e.notes||"",createdAt:new Date,updatedAt:new Date},t=this.maintenanceJobsSubject.value;return this.maintenanceJobsSubject.next([...t,a]),p(a)}updateMaintenanceJob(e,a){let t=this.maintenanceJobsSubject.value,i=t.findIndex(s=>s.id===e);if(i===-1)throw new Error(`Maintenance job with id ${e} not found`);let r=l(u(u({},t[i]),a),{updatedAt:new Date}),c=[...t];return c[i]=r,this.maintenanceJobsSubject.next(c),p(r)}updateJobStatus(e,a){let t={status:a};return a==="completed"?t.completionDate=new Date:a==="in-progress"&&!this.selectedJob()?.startDate&&(t.startDate=new Date),this.updateMaintenanceJob(e,t)}updateTaskStatus(e,a,t){let r=this.maintenanceJobsSubject.value.find(s=>s.id===e);if(!r)throw new Error(`Job with id ${e} not found`);let c=r.tasks.map(s=>{if(s.id===a){let d=l(u({},s),{status:t});return t==="completed"&&(d.completedAt=new Date),d}return s});return this.updateMaintenanceJob(e,{tasks:c})}addApprovalRequest(e,a){let t=l(u({},a),{id:this.generateId(),requestedAt:new Date,status:"pending"}),r=this.maintenanceJobsSubject.value.find(s=>s.id===e);if(!r)throw new Error(`Job with id ${e} not found`);let c=[...r.approvalRequests,t];return this.updateMaintenanceJob(e,{approvalRequests:c,status:"waiting-approval"})}approveRequest(e,a,t){let r=this.maintenanceJobsSubject.value.find(o=>o.id===e);if(!r)throw new Error(`Job with id ${e} not found`);let c=r.approvalRequests.map(o=>o.id===a?l(u({},o),{status:"approved",approvedBy:t,approvedAt:new Date}):o),d=c.some(o=>o.status==="pending")?"waiting-approval":"in-progress";return this.updateMaintenanceJob(e,{approvalRequests:c,status:d})}rejectRequest(e,a,t){let r=this.maintenanceJobsSubject.value.find(s=>s.id===e);if(!r)throw new Error(`Job with id ${e} not found`);let c=r.approvalRequests.map(s=>s.id===a?l(u({},s),{status:"rejected",rejectionReason:t}):s);return this.updateMaintenanceJob(e,{approvalRequests:c})}getMaintenanceStats(){return this.maintenanceJobs$.pipe(m(e=>{let a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate()),i=e.length,r=e.filter(n=>["waiting","in-progress","waiting-approval","waiting-parts"].includes(n.status)).length,c=e.filter(n=>n.status==="completed"&&n.completionDate&&n.completionDate>=t).length,s=e.filter(n=>n.status==="waiting-approval").length,d=e.filter(n=>n.status==="completed"&&n.actualDuration),o=d.length>0?d.reduce((n,g)=>n+(g.actualDuration||0),0)/d.length/60:0,M=e.filter(n=>n.status==="completed"&&n.completionDate&&n.completionDate>=t).reduce((n,g)=>n+(g.actualCost||g.estimatedCost),0),b=new Date(a);b.setDate(b.getDate()-7);let v=e.filter(n=>n.createdAt>=b),k=v.filter(n=>n.status==="completed"),T=v.length>0?k.length/v.length*100:0;return{totalJobs:i,activeJobs:r,completedToday:c,pendingApprovals:s,averageCompletionTime:o,revenueToday:M,efficiency:T}}))}getMaintenanceHistory(e){return this.maintenanceJobs$.pipe(m(a=>a.filter(t=>t.carId===e&&t.status==="completed").map(t=>({jobId:t.id,carId:t.carId,licensePlate:t.licensePlate,serviceDate:t.completionDate,serviceType:t.jobTitle,mileage:t.currentMileage,cost:t.actualCost||t.estimatedCost,mechanicName:t.mechanicName,notes:t.notes})).sort((t,i)=>i.serviceDate.getTime()-t.serviceDate.getTime())))}getServiceTypes(){return p(this.mockServiceTypes)}deleteMaintenanceJob(e){let t=this.maintenanceJobsSubject.value.filter(i=>i.id!==e);return this.maintenanceJobsSubject.next(t),p(!0)}applyFilters(e,a){return a?e.filter(t=>{if(a.status&&a.status.length>0&&!a.status.includes(t.status)||a.priority&&a.priority.length>0&&!a.priority.includes(t.priority)||a.mechanicId&&t.mechanicId!==a.mechanicId)return!1;if(a.dateRange){let i=t.createdAt;if(i<a.dateRange.start||i>a.dateRange.end)return!1}if(a.searchTerm){let i=a.searchTerm.toLowerCase();if(![t.jobTitle,t.description,t.licensePlate,t.customerName,t.carDetails].join(" ").toLowerCase().includes(i))return!1}return!(a.carMake&&!t.carDetails.toLowerCase().includes(a.carMake.toLowerCase()))}):e}generateId(){return"id-"+Math.random().toString(36).substr(2,9)}static \u0275fac=function(a){return new(a||h)};static \u0275prov=D({token:h,factory:h.\u0275fac,providedIn:"root"})};export{f as a};
