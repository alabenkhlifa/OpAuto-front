import{a as S}from"./chunk-UJO3757W.js";import{K as d,P as h,U as v,a as s,b as u,ga as n,j as l,m as i,n as m,q as C}from"./chunk-DMTVNCDT.js";var b=class o{subscriptionService=v(S);carsSubject=new l([]);cars$=this.carsSubject.asObservable();searchQuery=n("");selectedMake=n("all");selectedStatus=n("all");mockCars=[{id:"car1",licensePlate:"123 TUN 2024",make:"BMW",model:"X5",year:2020,customerId:"customer1",lastServiceDate:new Date(2025,6,15),nextServiceDue:new Date(2025,9,15),totalServices:8,currentMileage:45e3,serviceStatus:"up-to-date",lastServiceType:"Oil Change & Filter"},{id:"car2",licensePlate:"456 TUN 2019",make:"Honda",model:"Civic",year:2019,customerId:"customer2",lastServiceDate:new Date(2025,5,20),nextServiceDue:new Date(2025,8,20),totalServices:12,currentMileage:78e3,serviceStatus:"due-soon",lastServiceType:"Brake System Check"},{id:"car3",licensePlate:"789 TUN 2021",make:"Toyota",model:"Camry",year:2021,customerId:"customer1",lastServiceDate:new Date(2025,4,10),nextServiceDue:new Date(2025,7,10),totalServices:5,currentMileage:32e3,serviceStatus:"overdue",lastServiceType:"Annual Inspection"},{id:"car4",licensePlate:"321 TUN 2022",make:"Mercedes",model:"C-Class",year:2022,customerId:"customer3",lastServiceDate:new Date(2025,7,1),nextServiceDue:new Date(2025,10,1),totalServices:3,currentMileage:15e3,serviceStatus:"up-to-date",lastServiceType:"Routine Maintenance"},{id:"car5",licensePlate:"654 TUN 2020",make:"Audi",model:"A4",year:2020,customerId:"customer4",lastServiceDate:new Date(2025,6,25),nextServiceDue:new Date(2025,9,25),totalServices:7,currentMileage:52e3,serviceStatus:"up-to-date",lastServiceType:"Tire Rotation"},{id:"car6",licensePlate:"147 TUN 2018",make:"Peugeot",model:"308",year:2018,customerId:"customer2",lastServiceDate:new Date(2025,3,15),nextServiceDue:new Date(2025,6,15),totalServices:15,currentMileage:95e3,serviceStatus:"overdue",lastServiceType:"Engine Diagnostics"}];mockCustomers=[{id:"customer1",name:"Ahmed Ben Ali",phone:"+216-20-123-456",email:"ahmed.benali@email.tn"},{id:"customer2",name:"Fatma Trabelsi",phone:"+216-25-789-123",email:"fatma.trabelsi@email.tn"},{id:"customer3",name:"Mohamed Khemir",phone:"+216-22-456-789",email:"mohamed.khemir@email.tn"},{id:"customer4",name:"Leila Mansouri",phone:"+216-28-654-321",email:"leila.mansouri@email.tn"}];constructor(){this.carsSubject.next(this.mockCars)}getCars(){return this.cars$}getCarById(e){return this.mockCars.find(t=>t.id===e)}getCustomerById(e){return this.mockCustomers.find(t=>t.id===e)}getCarsByCustomer(e){let t=this.mockCars.filter(r=>r.customerId===e);return i(t)}getCarsByMake(e){let t=this.mockCars.filter(r=>r.make.toLowerCase()===e.toLowerCase());return i(t)}getCarsByStatus(e){let t=this.mockCars.filter(r=>r.serviceStatus===e);return i(t)}searchCars(e){let t=this.mockCars.filter(r=>r.licensePlate.toLowerCase().includes(e.toLowerCase())||r.make.toLowerCase().includes(e.toLowerCase())||r.model.toLowerCase().includes(e.toLowerCase())||this.getCustomerById(r.customerId)?.name.toLowerCase().includes(e.toLowerCase()));return i(t)}getAvailableMakes(){return[...new Set(this.mockCars.map(e=>e.make))].sort()}createCar(e){return this.subscriptionService.getCurrentSubscriptionStatus().pipe(d(t=>{let r=this.mockCars.length,a=t.currentTier.limits.cars;if(a!==null&&r>=a)return m({error:"CAR_LIMIT_EXCEEDED",message:`Vehicle limit of ${a} reached for ${t.currentTier.name} tier`,currentCount:r,limit:a,tier:t.currentTier.name});let c=u(s({},e),{id:Date.now().toString()});return this.mockCars.push(c),this.carsSubject.next([...this.mockCars]),i(c)}))}canCreateCar(){return this.subscriptionService.getCurrentSubscriptionStatus().pipe(C(e=>{let t=this.mockCars.length,r=e.currentTier.limits.cars;return r===null?{canCreate:!0}:t>=r?{canCreate:!1,reason:`Vehicle limit of ${r} reached for ${e.currentTier.name} tier`}:{canCreate:!0}}))}getCurrentCarCount(){return this.mockCars.length}updateCar(e,t){let r=this.mockCars.findIndex(a=>a.id===e);if(r!==-1)return this.mockCars[r]=s(s({},this.mockCars[r]),t),this.carsSubject.next([...this.mockCars]),i(this.mockCars[r]);throw new Error("Car not found")}deleteCar(e){let t=this.mockCars.findIndex(r=>r.id===e);return t!==-1?(this.mockCars.splice(t,1),this.carsSubject.next([...this.mockCars]),i(!0)):i(!1)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a};
