import{a as me,b as H,d as Q,e as z,h as W,k as Y,n as J,o as ue,p as ve,q as _e,u as X,w as K}from"./chunk-2V6QG4GK.js";import{$ as P,A as f,Aa as M,B as m,C as y,Ca as D,F as S,K as l,N as q,Oa as U,Qa as $,T as re,X as u,Xa as ce,Y as v,a as G,aa as R,ba as h,ca as n,da as i,e as oe,ea as c,f as le,fa as w,ga as g,h as I,ha as s,j as L,na as se,o as T,oa as V,pa as o,q as E,qa as A,ra as C,sa as j,ta as de,u as pe,x as O,z as x}from"./chunk-6MGQ6QS3.js";var Z=(_=>(_.PART_PURCHASE="part_purchase",_.SERVICE_APPROVAL="service_approval",_.CUSTOMER_CREDIT="customer_credit",_.OVERTIME_REQUEST="overtime_request",_.EXPENSE_CLAIM="expense_claim",_.DISCOUNT_REQUEST="discount_request",_.REFUND_REQUEST="refund_request",_.OTHER="other",_))(Z||{}),ee=(d=>(d.PENDING="pending",d.APPROVED="approved",d.REJECTED="rejected",d.INFO_REQUESTED="info_requested",d.CANCELLED="cancelled",d))(ee||{}),te=(p=>(p.LOW="low",p.MEDIUM="medium",p.HIGH="high",p.URGENT="urgent",p))(te||{}),B={part_purchase:"Part Purchase",service_approval:"Service Approval",customer_credit:"Customer Credit",overtime_request:"Overtime Request",expense_claim:"Expense Claim",discount_request:"Discount Request",refund_request:"Refund Request",other:"Other"},F={pending:"Pending",approved:"Approved",rejected:"Rejected",info_requested:"Info Requested",cancelled:"Cancelled"},N={low:"Low",medium:"Medium",high:"High",urgent:"Urgent"};var ie=class a{approvalsSubject=new le(this.generateMockData());approvals$=this.approvalsSubject.asObservable();generateMockData(){return[{id:"1",type:"part_purchase",title:"Brake Pads for Mercedes C220",description:"Customer needs premium brake pads replacement. Original part recommended for better quality and warranty.",requestedBy:{id:"emp1",name:"Ahmed Slimani",role:"Lead Mechanic"},requestedAt:new Date("2024-12-28T10:30:00"),priority:"high",status:"pending",estimatedCost:285,currency:"TND",relatedEntity:{type:"maintenance",id:"maint_001",name:"Mercedes C220 Brake Service"},dueDate:new Date("2024-12-30T17:00:00"),createdAt:new Date("2024-12-28T10:30:00"),updatedAt:new Date("2024-12-28T10:30:00"),comments:[{id:"c1",content:"Customer specifically requested OEM parts for better reliability.",author:{id:"emp1",name:"Ahmed Slimani",role:"Lead Mechanic"},createdAt:new Date("2024-12-28T10:32:00"),isInternal:!0}]},{id:"2",type:"overtime_request",title:"Weekend Work for Urgent Repair",description:"Customer needs their car ready for Monday morning. Requesting approval for weekend overtime to complete transmission repair.",requestedBy:{id:"emp2",name:"Fatma Ben Ali",role:"Mechanic"},requestedAt:new Date("2024-12-27T16:45:00"),priority:"urgent",status:"pending",estimatedCost:150,currency:"TND",relatedEntity:{type:"maintenance",id:"maint_002",name:"Peugeot 308 Transmission Repair"},dueDate:new Date("2024-12-28T09:00:00"),createdAt:new Date("2024-12-27T16:45:00"),updatedAt:new Date("2024-12-27T16:45:00")},{id:"3",type:"discount_request",title:"15% Discount for Loyal Customer",description:"Mr. Karim has been our customer for 5 years with regular maintenance. Requesting special discount for major engine work.",requestedBy:{id:"emp1",name:"Ahmed Slimani",role:"Lead Mechanic"},requestedAt:new Date("2024-12-26T14:20:00"),priority:"medium",status:"approved",estimatedCost:450,currency:"TND",relatedEntity:{type:"customer",id:"cust_003",name:"Karim Essid"},approvedBy:{id:"admin1",name:"Garage Owner"},approvedAt:new Date("2024-12-26T15:30:00"),createdAt:new Date("2024-12-26T14:20:00"),updatedAt:new Date("2024-12-26T15:30:00")},{id:"4",type:"expense_claim",title:"New Tools Purchase",description:"Need to purchase diagnostic tool for modern vehicles. Will improve service quality and reduce diagnostic time.",requestedBy:{id:"emp3",name:"Mohamed Gharbi",role:"Senior Mechanic"},requestedAt:new Date("2024-12-25T11:15:00"),priority:"low",status:"rejected",estimatedCost:1250,currency:"TND",rejectedBy:{id:"admin1",name:"Garage Owner"},rejectedAt:new Date("2024-12-25T18:00:00"),createdAt:new Date("2024-12-25T11:15:00"),updatedAt:new Date("2024-12-25T18:00:00"),comments:[{id:"c2",content:"Budget constraints for this quarter. Please resubmit in Q1 2025.",author:{id:"admin1",name:"Garage Owner",role:"Admin"},createdAt:new Date("2024-12-25T18:00:00"),isInternal:!0}]},{id:"5",type:"service_approval",title:"Additional Engine Work",description:"During oil change, discovered engine mount issue. Customer approved verbal estimate but need written approval for additional work.",requestedBy:{id:"emp2",name:"Fatma Ben Ali",role:"Mechanic"},requestedAt:new Date("2024-12-28T09:15:00"),priority:"high",status:"info_requested",estimatedCost:320,currency:"TND",relatedEntity:{type:"maintenance",id:"maint_003",name:"Toyota Corolla Engine Mount Replacement"},createdAt:new Date("2024-12-28T09:15:00"),updatedAt:new Date("2024-12-28T11:30:00"),comments:[{id:"c3",content:"Need customer signature on written estimate before proceeding.",author:{id:"admin1",name:"Garage Owner",role:"Admin"},createdAt:new Date("2024-12-28T11:30:00"),isInternal:!1}]}]}getApprovals(e){return this.approvals$.pipe(L(t=>e?t.filter(r=>{if(e.status&&e.status.length>0&&!e.status.includes(r.status)||e.type&&e.type.length>0&&!e.type.includes(r.type)||e.priority&&e.priority.length>0&&!e.priority.includes(r.priority)||e.requestedBy&&e.requestedBy.length>0&&!e.requestedBy.includes(r.requestedBy.id))return!1;if(e.dateRange){let p=new Date(r.requestedAt);if(p<e.dateRange.start||p>e.dateRange.end)return!1}if(e.searchQuery){let p=e.searchQuery.toLowerCase();if(![r.title,r.description,r.requestedBy.name].join(" ").toLowerCase().includes(p))return!1}return!0}):t),T(300))}getApprovalById(e){return this.approvals$.pipe(L(t=>t.find(r=>r.id===e)),T(200))}createApproval(e){let t={id:`approval_${Date.now()}`,type:e.type,title:e.title,description:e.description,priority:e.priority,estimatedCost:e.estimatedCost,currency:e.currency,relatedEntity:e.relatedEntityType&&e.relatedEntityId?{type:e.relatedEntityType,id:e.relatedEntityId,name:`${e.relatedEntityType} ${e.relatedEntityId}`}:void 0,dueDate:e.dueDate,requestedBy:{id:"current_user",name:"Current User",role:"Mechanic"},requestedAt:new Date,status:"pending",createdAt:new Date,updatedAt:new Date},r=this.approvalsSubject.value;return this.approvalsSubject.next([t,...r]),I(t).pipe(T(500))}processApproval(e){let t=this.approvalsSubject.value,r=t.findIndex(k=>k.id===e.approvalId);if(r===-1)throw new Error("Approval not found");let p=G({},t[r]),d=new Date;switch(e.action){case"approve":p.status="approved",p.approvedBy={id:"admin1",name:"Garage Owner"},p.approvedAt=d;break;case"reject":p.status="rejected",p.rejectedBy={id:"admin1",name:"Garage Owner"},p.rejectedAt=d;break;case"request_info":p.status="info_requested";break}if(e.comment){let k={id:`comment_${Date.now()}`,content:e.comment,author:{id:"admin1",name:"Garage Owner",role:"Admin"},createdAt:d,isInternal:e.action==="request_info"};p.comments=[...p.comments||[],k]}p.updatedAt=d;let b=[...t];return b[r]=p,this.approvalsSubject.next(b),I(p).pipe(T(300))}getApprovalStats(){return this.approvals$.pipe(L(e=>({total:e.length,pending:e.filter(r=>r.status==="pending").length,approved:e.filter(r=>r.status==="approved").length,rejected:e.filter(r=>r.status==="rejected").length,overdue:e.filter(r=>r.status==="pending"&&r.dueDate&&new Date>r.dueDate).length,byPriority:{low:e.filter(r=>r.priority==="low").length,medium:e.filter(r=>r.priority==="medium").length,high:e.filter(r=>r.priority==="high").length,urgent:e.filter(r=>r.priority==="urgent").length},byType:{partPurchase:e.filter(r=>r.type==="part_purchase").length,serviceApproval:e.filter(r=>r.type==="service_approval").length,customerCredit:e.filter(r=>r.type==="customer_credit").length,overtime:e.filter(r=>r.type==="overtime_request").length,expense:e.filter(r=>r.type==="expense_claim").length,other:e.filter(r=>r.type==="other").length},avgResponseTime:2.5})),T(200))}getPendingApprovals(){return this.getApprovals({status:["pending","info_requested"]})}getOverdueApprovals(){return this.approvals$.pipe(L(e=>e.filter(t=>t.status==="pending"&&t.dueDate&&new Date>t.dueDate)),T(200))}addComment(e,t,r=!0){let p=this.approvalsSubject.value,d=p.findIndex(fe=>fe.id===e);if(d===-1)throw new Error("Approval not found");let b=G({},p[d]),k={id:`comment_${Date.now()}`,content:t,author:{id:"current_user",name:"Current User",role:"Admin"},createdAt:new Date,isInternal:r};b.comments=[...b.comments||[],k],b.updatedAt=new Date;let _=[...p];return _[d]=b,this.approvalsSubject.next(_),I(b).pipe(T(200))}deleteApproval(e){let r=this.approvalsSubject.value.filter(p=>p.id!==e);return this.approvalsSubject.next(r),I(!0).pipe(T(200))}bulkAction(e,t){let p=[...this.approvalsSubject.value],d=new Date;return e.forEach(b=>{let k=p.findIndex(_=>_.id===b);if(k!==-1)if(t==="delete")p=p.filter(_=>_.id!==b);else{let _=G({},p[k]);t==="approve"?(_.status="approved",_.approvedBy={id:"admin1",name:"Garage Owner"},_.approvedAt=d):t==="reject"&&(_.status="rejected",_.rejectedBy={id:"admin1",name:"Garage Owner"},_.rejectedAt=d),_.updatedAt=d,p[k]=_}}),this.approvalsSubject.next(p),I(!0).pipe(T(500))}static \u0275fac=function(t){return new(t||a)};static \u0275prov=pe({token:a,factory:a.\u0275fac,providedIn:"root"})};var ye=(a,e)=>e.id;function be(a,e){a&1&&(n(0,"span",27),o(1,"(Overdue)"),i())}function Ee(a,e){if(a&1&&(n(0,"div",20)(1,"span",21),o(2,"Due date:"),i(),n(3,"span",23),o(4),M(5,"date"),u(6,be,2,0,"span",27),i()()),a&2){let t=s();l(3),se("text-red-400",t.isOverdue(t.approval.dueDate)),l(),C(" ",D(5,4,t.approval.dueDate,"MMM d, y h:mm a")," "),l(2),v(t.isOverdue(t.approval.dueDate)?6:-1)}}function Se(a,e){if(a&1&&(n(0,"div",20)(1,"span",21),o(2,"Related to:"),i(),n(3,"span",23),o(4),i()()),a&2){let t=s(2);l(4),A(t.approval.relatedEntity.name)}}function we(a,e){if(a&1&&(n(0,"div")(1,"h3",18),o(2,"Financial Details"),i(),n(3,"div",19)(4,"div",20)(5,"span",21),o(6,"Estimated cost:"),i(),n(7,"span",28),o(8),i()(),u(9,Se,5,1,"div",20),i()()),a&2){let t=s();l(8),j(" ",t.approval.estimatedCost," ",t.approval.currency," "),l(),v(t.approval.relatedEntity?9:-1)}}function Te(a,e){if(a&1&&(n(0,"div",31),m(),n(1,"svg",32),c(2,"path",33),i(),y(),n(3,"span",34),o(4),i()(),n(5,"p",35),o(6),M(7,"date"),i()),a&2){let t=s(2);l(4),C("Approved by ",t.approval.approvedBy.name),l(2),C(" Approved on ",D(7,2,t.approval.approvedAt,"MMM d, y h:mm a")," ")}}function ke(a,e){if(a&1&&(n(0,"div",36),m(),n(1,"svg",32),c(2,"path",12),i(),y(),n(3,"span",34),o(4),i()(),n(5,"p",35),o(6),M(7,"date"),i()),a&2){let t=s(2);l(4),C("Rejected by ",t.approval.rejectedBy.name),l(2),C(" Rejected on ",D(7,2,t.approval.rejectedAt,"MMM d, y h:mm a")," ")}}function Me(a,e){a&1&&(n(0,"div",30),m(),n(1,"svg",32),c(2,"path",37),i(),y(),n(3,"span",34),o(4,"Additional information requested"),i()())}function De(a,e){if(a&1&&(n(0,"div",14)(1,"h3",18),o(2,"Status Information"),i(),n(3,"div",29),u(4,Te,8,5),u(5,ke,8,5),u(6,Me,5,0,"div",30),i()()),a&2){let t=s();l(4),v(t.approval.status==="approved"&&t.approval.approvedBy?4:-1),l(),v(t.approval.status==="rejected"&&t.approval.rejectedBy?5:-1),l(),v(t.approval.status==="info_requested"?6:-1)}}function Pe(a,e){a&1&&(n(0,"span",44),o(1," Internal "),i())}function Re(a,e){if(a&1&&(n(0,"div",39)(1,"div",40)(2,"div",41)(3,"span",42),o(4),i(),n(5,"span",43),o(6),i(),u(7,Pe,2,0,"span",44),i(),n(8,"span",43),o(9),M(10,"date"),i()(),n(11,"p",35),o(12),i()()),a&2){let t=e.$implicit;l(4),A(t.author.name),l(2),A(t.author.role),l(),v(t.isInternal?7:-1),l(2),A(D(10,5,t.createdAt,"MMM d, h:mm a")),l(3),A(t.content)}}function Ie(a,e){if(a&1&&(n(0,"div",14)(1,"h3",18),o(2,"Comments"),i(),n(3,"div",38),P(4,Re,13,8,"div",39,ye),i()()),a&2){let t=s();l(4),R(t.approval.comments)}}function Oe(a,e){if(a&1){let t=w();n(0,"div")(1,"h3",18),o(2,"Add Comment"),i(),n(3,"form",45),g("ngSubmit",function(){x(t);let p=s();return f(p.addComment())}),n(4,"div",38),c(5,"textarea",46),n(6,"div",47),c(7,"input",48),n(8,"label",49),o(9,"Internal comment (not visible to requester)"),i()()()()()}if(a&2){let t=s();l(3),h("formGroup",t.commentForm)}}function Ve(a,e){a&1&&(m(),n(0,"svg",54),c(1,"circle",55)(2,"path",56),i(),o(3," Approving... "))}function Le(a,e){a&1&&(m(),n(0,"svg",57),c(1,"path",58),i(),o(2," Approve "))}function je(a,e){a&1&&(m(),n(0,"svg",54),c(1,"circle",55)(2,"path",56),i(),o(3," Rejecting... "))}function Be(a,e){a&1&&(m(),n(0,"svg",57),c(1,"path",12),i(),o(2," Reject "))}function Fe(a,e){a&1&&(m(),n(0,"svg",54),c(1,"circle",55)(2,"path",56),i(),o(3," Requesting... "))}function Ne(a,e){a&1&&(m(),n(0,"svg",57),c(1,"path",37),i(),o(2," Request Info "))}function Ge(a,e){if(a&1){let t=w();n(0,"div",25)(1,"div",47)(2,"button",50),g("click",function(){x(t);let p=s();return f(p.processApproval("approve"))}),u(3,Ve,4,0)(4,Le,3,0),i(),n(5,"button",51),g("click",function(){x(t);let p=s();return f(p.processApproval("reject"))}),u(6,je,4,0)(7,Be,3,0),i(),n(8,"button",52),g("click",function(){x(t);let p=s();return f(p.processApproval("request_info"))}),u(9,Fe,4,0)(10,Ne,3,0),i()(),n(11,"button",53),g("click",function(){x(t);let p=s();return f(p.onClose())}),o(12," Close "),i()()}if(a&2){let t=s();l(2),h("disabled",t.isProcessing()),l(),v(t.isProcessing()&&t.currentAction()==="approve"?3:4),l(2),h("disabled",t.isProcessing()),l(),v(t.isProcessing()&&t.currentAction()==="reject"?6:7),l(2),h("disabled",t.isProcessing()),l(),v(t.isProcessing()&&t.currentAction()==="request_info"?9:10),l(2),h("disabled",t.isProcessing())}}function qe(a,e){if(a&1){let t=w();n(0,"div",26)(1,"button",59),g("click",function(){x(t);let p=s();return f(p.onClose())}),o(2," Close "),i()()}}var ne=class a{fb=O(X);approval;isOpen=!1;close=new re;action=new re;commentForm;isProcessing=S(!1);currentAction=S("");ngOnInit(){this.initializeCommentForm()}initializeCommentForm(){this.commentForm=this.fb.group({comment:[""],isInternal:[!0]})}onClose(){this.isProcessing()||this.close.emit()}processApproval(e){this.isProcessing.set(!0),this.currentAction.set(e);let t=this.commentForm.get("comment")?.value;setTimeout(()=>{this.action.emit({action:e,comment:t||void 0}),this.isProcessing.set(!1),this.currentAction.set("")},1e3)}addComment(){if(this.commentForm.valid){let e=this.commentForm.get("comment")?.value;e?.trim()&&(this.action.emit({action:"comment",comment:e}),this.commentForm.reset({isInternal:!0}))}}isOverdue(e){return new Date>new Date(e)}getTypeLabel(e){return B[e]||e}getStatusLabel(e){return F[e]||e}getPriorityLabel(e){return N[e]||e}getPriorityBadgeClass(e){let t={low:"badge-priority-low",medium:"badge-priority-medium",high:"badge-priority-high",urgent:"badge-priority-urgent"};return t[e]||t.medium}getStatusBadgeClass(e){let t={pending:"badge-pending",approved:"badge-completed",rejected:"badge-cancelled",info_requested:"badge-active",cancelled:"badge-cancelled"};return t[e]||t.pending}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=q({type:a,selectors:[["app-approval-modal"]],inputs:{approval:"approval",isOpen:"isOpen"},outputs:{close:"close",action:"action"},decls:54,vars:21,consts:[[1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","min-h-screen","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","backdrop-blur-sm",3,"click"],[1,"relative","glass-modal","max-w-2xl","w-full","max-h-[90vh]","overflow-hidden"],[1,"p-6","border-b","border-gray-600"],[1,"flex","items-start","justify-between"],[1,"text-xl","font-semibold","text-white","mb-2"],[1,"flex","items-center","space-x-4"],[1,"badge","badge-active"],[1,"badge"],[1,"text-gray-400","hover:text-gray-200",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","overflow-y-auto","max-h-[60vh]"],[1,"mb-6"],[1,"text-md","font-medium","text-white","mb-2"],[1,"text-gray-300"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-6"],[1,"text-md","font-medium","text-white","mb-3"],[1,"space-y-2","text-sm"],[1,"flex","justify-between"],[1,"text-gray-400"],[1,"text-white","font-medium"],[1,"text-white"],[1,"p-6","border-t","border-gray-600","bg-gray-800","bg-opacity-50"],[1,"flex","items-center","justify-between"],[1,"flex","justify-end"],[1,"text-xs","ml-1"],[1,"text-white","font-medium","text-lg"],[1,"bg-gray-700","bg-opacity-50","p-4","rounded-lg"],[1,"flex","items-center","text-blue-600","dark:text-blue-400","mb-2"],[1,"flex","items-center","text-green-600","dark:text-green-400","mb-2"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"font-medium"],[1,"text-sm","text-gray-300"],[1,"flex","items-center","text-red-600","dark:text-red-400","mb-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"space-y-3"],[1,"bg-gray-700","bg-opacity-50","p-3","rounded-lg"],[1,"flex","items-start","justify-between","mb-2"],[1,"flex","items-center","space-x-2"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-gray-400"],[1,"badge","badge-pending","badge-sm"],[3,"ngSubmit","formGroup"],["formControlName","comment","rows","3","placeholder","Add your comment or feedback...",1,"glass-input"],[1,"flex","items-center","space-x-3"],["type","checkbox","id","internalComment","formControlName","isInternal",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["for","internalComment",1,"text-sm","text-gray-300"],["type","button",1,"btn-success",3,"click","disabled"],["type","button",1,"btn-danger",3,"click","disabled"],["type","button",1,"btn-tertiary",3,"click","disabled"],["type","button",1,"btn-secondary",3,"click","disabled"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","w-4","h-4"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["type","button",1,"btn-secondary",3,"click"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),g("click",function(){return r.onClose()}),i(),n(3,"div",3)(4,"div",4)(5,"div",5)(6,"div")(7,"h2",6),o(8),i(),n(9,"div",7)(10,"span",8),o(11),i(),n(12,"span",9),o(13),i(),n(14,"span",9),o(15),i()()(),n(16,"button",10),g("click",function(){return r.onClose()}),m(),n(17,"svg",11),c(18,"path",12),i()()()(),y(),n(19,"div",13)(20,"div",14)(21,"h3",15),o(22,"Description"),i(),n(23,"p",16),o(24),i()(),n(25,"div",17)(26,"div")(27,"h3",18),o(28,"Request Details"),i(),n(29,"div",19)(30,"div",20)(31,"span",21),o(32,"Requested by:"),i(),n(33,"span",22),o(34),i()(),n(35,"div",20)(36,"span",21),o(37,"Role:"),i(),n(38,"span",23),o(39),i()(),n(40,"div",20)(41,"span",21),o(42,"Requested on:"),i(),n(43,"span",23),o(44),M(45,"date"),i()(),u(46,Ee,7,7,"div",20),i()(),u(47,we,10,3,"div"),i(),u(48,De,7,3,"div",14),u(49,Ie,6,0,"div",14),u(50,Oe,10,1,"div"),i(),n(51,"div",24),u(52,Ge,13,7,"div",25)(53,qe,3,0,"div",26),i()()()()),t&2&&(l(8),A(r.approval.title),l(3),C(" ",r.getTypeLabel(r.approval.type)," "),l(),V(r.getPriorityBadgeClass(r.approval.priority)),l(),C(" ",r.getPriorityLabel(r.approval.priority)," "),l(),V(r.getStatusBadgeClass(r.approval.status)),l(),C(" ",r.getStatusLabel(r.approval.status)," "),l(9),A(r.approval.description),l(10),A(r.approval.requestedBy.name),l(5),A(r.approval.requestedBy.role),l(5),A(D(45,18,r.approval.requestedAt,"MMM d, y h:mm a")),l(2),v(r.approval.dueDate?46:-1),l(),v(r.approval.estimatedCost?47:-1),l(),v(r.approval.status!=="pending"?48:-1),l(),v(r.approval.comments&&r.approval.comments.length>0?49:-1),l(),v(r.approval.status==="pending"||r.approval.status==="info_requested"?50:-1),l(2),v(r.approval.status==="pending"||r.approval.status==="info_requested"?52:53))},dependencies:[$,U,K,W,H,me,Q,z,Y,J],encapsulation:2})};var ae=(a,e)=>e.value,Ue=(a,e)=>e.id;function $e(a,e){if(a&1){let t=w();n(0,"div",8)(1,"button",31),g("click",function(){x(t);let p=s();return f(p.bulkApprove())}),m(),n(2,"svg",6),c(3,"path",32),i(),o(4),i(),y(),n(5,"button",33),g("click",function(){x(t);let p=s();return f(p.bulkReject())}),m(),n(6,"svg",6),c(7,"path",34),i(),o(8),i()()}if(a&2){let t=s();l(),h("disabled",t.isBulkProcessing()),l(3),C(" Approve (",t.selectedApprovals().length,") "),l(),h("disabled",t.isBulkProcessing()),l(3),C(" Reject (",t.selectedApprovals().length,") ")}}function He(a,e){if(a&1&&(n(0,"div",9)(1,"div",23)(2,"div",20)(3,"div")(4,"p",35),o(5,"Pending"),i(),n(6,"p",36),o(7),i()(),n(8,"div",37),o(9,"\u23F1\uFE0F"),i()()(),n(10,"div",23)(11,"div",20)(12,"div")(13,"p",35),o(14,"Overdue"),i(),n(15,"p",36),o(16),i()(),n(17,"div",37),o(18,"\u{1F6A8}"),i()()(),n(19,"div",23)(20,"div",20)(21,"div")(22,"p",35),o(23,"Approved"),i(),n(24,"p",36),o(25),i()(),n(26,"div",37),o(27,"\u2705"),i()()(),n(28,"div",23)(29,"div",20)(30,"div")(31,"p",35),o(32,"Total"),i(),n(33,"p",36),o(34),i()(),n(35,"div",37),o(36,"\u{1F4CB}"),i()()()()),a&2){let t=s();l(7),A(t.stats().pending),l(9),A(t.stats().overdue),l(9),A(t.stats().approved),l(9),A(t.stats().total)}}function Qe(a,e){if(a&1&&(n(0,"option",17),o(1),i()),a&2){let t=e.$implicit;h("value",t.value),l(),A(t.label)}}function ze(a,e){if(a&1&&(n(0,"option",17),o(1),i()),a&2){let t=e.$implicit;h("value",t.value),l(),A(t.label)}}function We(a,e){if(a&1&&(n(0,"option",17),o(1),i()),a&2){let t=e.$implicit;h("value",t.value),l(),A(t.label)}}function Ye(a,e){if(a&1){let t=w();n(0,"div",8)(1,"input",38),g("change",function(){x(t);let p=s();return f(p.toggleSelectAll())}),i(),n(2,"span",22),o(3,"Select All"),i()()}if(a&2){let t=s();l(),h("checked",t.isAllSelected())("indeterminate",t.isSomeSelected())}}function Je(a,e){a&1&&(n(0,"div",27),m(),n(1,"svg",39),c(2,"circle",40)(3,"path",41),i(),y(),n(4,"span",42),o(5,"Loading approvals..."),i()())}function Xe(a,e){a&1&&(n(0,"div",28),m(),n(1,"svg",43),c(2,"path",44),i(),y(),n(3,"h3",45),o(4,"No approvals found"),i(),n(5,"p",3),o(6,"There are no approval requests matching your criteria."),i()())}function Ke(a,e){if(a&1&&(n(0,"span",55),m(),n(1,"svg",56),c(2,"path",63),i(),o(3),i()),a&2){let t=s().$implicit;l(3),j(" ",t.estimatedCost," ",t.currency," ")}}function Ze(a,e){if(a&1){let t=w();n(0,"div",62)(1,"button",64),g("click",function(){x(t);let p=s().$implicit,d=s(2);return f(d.approveRequest(p.id))}),m(),n(2,"svg",65),c(3,"path",32),i(),o(4," Approve "),i(),y(),n(5,"button",66),g("click",function(){x(t);let p=s().$implicit,d=s(2);return f(d.rejectRequest(p.id))}),m(),n(6,"svg",65),c(7,"path",34),i(),o(8," Reject "),i(),y(),n(9,"button",5),g("click",function(){x(t);let p=s().$implicit,d=s(2);return f(d.requestMoreInfo(p.id))}),m(),n(10,"svg",65),c(11,"path",67),i(),o(12," Request Info "),i(),y(),n(13,"button",68),g("click",function(){x(t);let p=s().$implicit,d=s(2);return f(d.viewDetails(p))}),m(),n(14,"svg",65),c(15,"path",69)(16,"path",70),i(),o(17," View Details "),i()()}}function et(a,e){if(a&1&&(n(0,"span",71),o(1),M(2,"date"),i()),a&2){let t=s(2).$implicit;l(),de(" ",t.status==="approved"?"Approved":"Rejected"," by ",t.status==="approved"?t.approvedBy==null?null:t.approvedBy.name:t.rejectedBy==null?null:t.rejectedBy.name," on ",D(2,3,t.status==="approved"?t.approvedAt:t.rejectedAt,"MMM d, y")," ")}}function tt(a,e){if(a&1){let t=w();n(0,"div",62)(1,"button",68),g("click",function(){x(t);let p=s().$implicit,d=s(2);return f(d.viewDetails(p))}),m(),n(2,"svg",65),c(3,"path",69)(4,"path",70),i(),o(5," View Details "),i(),u(6,et,3,6,"span",71),i()}if(a&2){let t=s().$implicit;l(6),v(t.status==="approved"||t.status==="rejected"?6:-1)}}function it(a,e){if(a&1){let t=w();n(0,"div",46)(1,"div",47)(2,"input",48),g("change",function(){let p=x(t).$implicit,d=s(2);return f(d.toggleSelection(p.id))}),i(),n(3,"div",49)(4,"div",50)(5,"div",51)(6,"h3",52),o(7),i(),n(8,"p",53),o(9),i(),n(10,"div",54)(11,"span",55),m(),n(12,"svg",56),c(13,"path",57),i(),o(14),i(),y(),n(15,"span",55),m(),n(16,"svg",56),c(17,"path",58),i(),o(18),M(19,"date"),i(),u(20,Ke,4,2,"span",55),i()(),y(),n(21,"div",59)(22,"span",60),o(23),i(),n(24,"span",61),o(25),i(),n(26,"span",61),o(27),i()()(),u(28,Ze,18,0,"div",62)(29,tt,7,1,"div",62),i()()()}if(a&2){let t=e.$implicit,r=s(2);l(2),h("checked",r.selectedApprovals().includes(t.id)),l(5),C(" ",t.title," "),l(2),C(" ",t.description," "),l(5),C(" ",t.requestedBy.name," "),l(4),C(" ",D(19,14,t.requestedAt,"MMM d, y")," "),l(2),v(t.estimatedCost?20:-1),l(3),C(" ",r.getTypeLabel(t.type)," "),l(),V(r.getPriorityBadgeClass(t.priority)),l(),C(" ",r.getPriorityLabel(t.priority)," "),l(),V(r.getStatusBadgeClass(t.status)),l(),C(" ",r.getStatusLabel(t.status)," "),l(),v(t.status==="pending"||t.status==="info_requested"?28:29)}}function nt(a,e){if(a&1&&(n(0,"div",29),P(1,it,30,17,"div",46,Ue),i()),a&2){let t=s();l(),R(t.filteredApprovals())}}function rt(a,e){if(a&1){let t=w();n(0,"app-approval-modal",72),g("close",function(){x(t);let p=s();return f(p.closeModal())})("action",function(p){x(t);let d=s();return f(d.handleApprovalAction(p))}),i()}if(a&2){let t=s();h("approval",t.selectedApprovalForModal())("isOpen",!0)}}var xe=class a{fb=O(X);router=O(ce);approvalService=O(ie);destroy$=new oe;approvals=S([]);filteredApprovals=S([]);stats=S(null);isLoading=S(!0);selectedApprovals=S([]);selectedApprovalForModal=S(null);isBulkProcessing=S(!1);filterForm;statusOptions=Object.values(ee).map(e=>({value:e,label:F[e]}));typeOptions=Object.values(Z).map(e=>({value:e,label:B[e]}));priorityOptions=Object.values(te).map(e=>({value:e,label:N[e]}));ngOnInit(){this.initializeFilterForm(),this.loadApprovals(),this.loadStats(),this.setupFilterWatcher()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeFilterForm(){this.filterForm=this.fb.group({searchQuery:[""],status:[""],type:[""],priority:[""]})}setupFilterWatcher(){this.filterForm.valueChanges.pipe(E(this.destroy$)).subscribe(()=>{this.applyFilters()})}loadApprovals(){this.isLoading.set(!0),this.approvalService.getApprovals().pipe(E(this.destroy$)).subscribe({next:e=>{this.approvals.set(e),this.applyFilters(),this.isLoading.set(!1)},error:e=>{console.error("Error loading approvals:",e),this.isLoading.set(!1)}})}loadStats(){this.approvalService.getApprovalStats().pipe(E(this.destroy$)).subscribe({next:e=>{this.stats.set(e)},error:e=>{console.error("Error loading approval stats:",e)}})}applyFilters(){let e=this.filterForm.value,t={};e.searchQuery&&(t.searchQuery=e.searchQuery),e.status&&(t.status=[e.status]),e.type&&(t.type=[e.type]),e.priority&&(t.priority=[e.priority]),this.approvalService.getApprovals(t).pipe(E(this.destroy$)).subscribe({next:r=>{this.filteredApprovals.set(r)}})}refreshApprovals(){this.loadApprovals(),this.loadStats()}resetFilters(){this.filterForm.reset(),this.filteredApprovals.set(this.approvals())}toggleSelection(e){let t=this.selectedApprovals();t.includes(e)?this.selectedApprovals.set(t.filter(r=>r!==e)):this.selectedApprovals.set([...t,e])}toggleSelectAll(){let e=this.selectedApprovals(),t=this.filteredApprovals().map(r=>r.id);e.length===t.length?this.selectedApprovals.set([]):this.selectedApprovals.set(t)}isAllSelected(){let e=this.selectedApprovals(),t=this.filteredApprovals().map(r=>r.id);return e.length>0&&e.length===t.length}isSomeSelected(){let e=this.selectedApprovals(),t=this.filteredApprovals().map(r=>r.id);return e.length>0&&e.length<t.length}approveRequest(e){this.approvalService.processApproval({approvalId:e,action:"approve"}).pipe(E(this.destroy$)).subscribe({next:()=>{this.refreshApprovals()}})}rejectRequest(e){this.approvalService.processApproval({approvalId:e,action:"reject"}).pipe(E(this.destroy$)).subscribe({next:()=>{this.refreshApprovals()}})}requestMoreInfo(e){this.approvalService.processApproval({approvalId:e,action:"request_info",comment:"More information needed before approval"}).pipe(E(this.destroy$)).subscribe({next:()=>{this.refreshApprovals()}})}viewDetails(e){this.selectedApprovalForModal.set(e)}closeModal(){this.selectedApprovalForModal.set(null)}handleApprovalAction(e){let t=this.selectedApprovalForModal();t&&this.approvalService.processApproval({approvalId:t.id,action:e.action,comment:e.comment}).pipe(E(this.destroy$)).subscribe({next:()=>{this.refreshApprovals(),this.closeModal()}})}bulkApprove(){this.isBulkProcessing.set(!0),this.approvalService.bulkAction(this.selectedApprovals(),"approve").pipe(E(this.destroy$)).subscribe({next:()=>{this.selectedApprovals.set([]),this.refreshApprovals(),this.isBulkProcessing.set(!1)},error:()=>{this.isBulkProcessing.set(!1)}})}bulkReject(){this.isBulkProcessing.set(!0),this.approvalService.bulkAction(this.selectedApprovals(),"reject").pipe(E(this.destroy$)).subscribe({next:()=>{this.selectedApprovals.set([]),this.refreshApprovals(),this.isBulkProcessing.set(!1)},error:()=>{this.isBulkProcessing.set(!1)}})}getTypeLabel(e){return B[e]}getStatusLabel(e){return F[e]}getPriorityLabel(e){return N[e]}getPriorityBadgeClass(e){return{low:"badge-priority-low",medium:"badge-priority-medium",high:"badge-priority-high",urgent:"badge-priority-urgent"}[e]}getStatusBadgeClass(e){return{pending:"badge-pending",approved:"badge-completed",rejected:"badge-cancelled",info_requested:"badge-active",cancelled:"badge-cancelled"}[e]}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=q({type:a,selectors:[["app-approvals"]],decls:61,vars:8,consts:[[1,"p-6","max-w-7xl","mx-auto"],[1,"flex","flex-col","lg:flex-row","lg:items-center","lg:justify-between","mb-6"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-gray-300"],[1,"flex","items-center","space-x-3","mt-4","lg:mt-0"],[1,"btn-secondary","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"flex","items-center","space-x-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"glass-card","mb-6"],[1,"space-y-4",3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"form-label"],["type","text","formControlName","searchQuery","placeholder","Search approvals...",1,"form-input"],["formControlName","status",1,"form-select"],["value",""],[3,"value"],["formControlName","type",1,"form-select"],["formControlName","priority",1,"form-select"],[1,"flex","items-center","justify-between"],["type","button",1,"btn-secondary","text-sm",3,"click"],[1,"text-sm","text-gray-300"],[1,"glass-card"],[1,"p-6","border-b","border-gray-600"],[1,"text-lg","font-semibold","text-white"],[1,"p-6"],[1,"flex","items-center","justify-center","py-12"],[1,"text-center","py-12"],[1,"space-y-4"],[3,"approval","isOpen"],[1,"btn-success","text-sm",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"btn-danger","text-sm",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-sm","font-medium","text-gray-300"],[1,"text-2xl","font-bold","text-white"],[1,"text-2xl"],["type","checkbox",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"change","checked","indeterminate"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","w-8","h-8","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"ml-2","text-gray-300"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-12","h-12","text-gray-400","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-medium","text-white","mb-2"],[1,"border","border-gray-600","rounded-lg","p-4","hover:bg-gray-700","hover:bg-opacity-50","transition-colors"],[1,"flex","items-start","space-x-3"],["type","checkbox",1,"mt-1","w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500",3,"change","checked"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"text-md","font-medium","text-white","mb-1"],[1,"text-sm","text-gray-300","mb-2"],[1,"flex","flex-wrap","items-center","gap-4","text-sm","text-gray-400"],[1,"flex","items-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-3","h-3","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex","items-start","space-x-2","ml-4"],[1,"badge","badge-active"],[1,"badge"],[1,"flex","items-center","space-x-2","mt-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"],[1,"btn-success","text-sm",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-3","h-3"],[1,"btn-danger","text-sm",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"btn-tertiary","text-sm",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 616 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"text-sm","text-gray-400"],[3,"close","action","approval","isOpen"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),o(4,"Approval Requests"),i(),n(5,"p",3),o(6,"Manage and review pending approval requests"),i()(),n(7,"div",4)(8,"button",5),g("click",function(){return r.refreshApprovals()}),m(),n(9,"svg",6),c(10,"path",7),i(),o(11," Refresh "),i(),u(12,$e,9,4,"div",8),i()(),u(13,He,37,4,"div",9),y(),n(14,"div",10)(15,"form",11)(16,"div",12)(17,"div")(18,"label",13),o(19,"Search"),i(),c(20,"input",14),i(),n(21,"div")(22,"label",13),o(23,"Status"),i(),n(24,"select",15)(25,"option",16),o(26,"All Status"),i(),P(27,Qe,2,2,"option",17,ae),i()(),n(29,"div")(30,"label",13),o(31,"Type"),i(),n(32,"select",18)(33,"option",16),o(34,"All Types"),i(),P(35,ze,2,2,"option",17,ae),i()(),n(37,"div")(38,"label",13),o(39,"Priority"),i(),n(40,"select",19)(41,"option",16),o(42,"All Priorities"),i(),P(43,We,2,2,"option",17,ae),i()()(),n(45,"div",20)(46,"button",21),g("click",function(){return r.resetFilters()}),o(47," Reset Filters "),i(),n(48,"div",22),o(49),i()()()(),n(50,"div",23)(51,"div",24)(52,"div",20)(53,"h2",25),o(54,"Approval Requests"),i(),u(55,Ye,4,2,"div",8),i()(),n(56,"div",26),u(57,Je,6,0,"div",27)(58,Xe,7,0,"div",28)(59,nt,3,0,"div",29),i()()(),u(60,rt,1,2,"app-approval-modal",30)),t&2&&(l(12),v(r.selectedApprovals().length>0?12:-1),l(),v(r.stats()?13:-1),l(2),h("formGroup",r.filterForm),l(12),R(r.statusOptions),l(8),R(r.typeOptions),l(8),R(r.priorityOptions),l(6),j(" ",r.filteredApprovals().length," of ",r.approvals().length," approvals "),l(6),v(r.filteredApprovals().length>0?55:-1),l(2),v(r.isLoading()?57:r.filteredApprovals().length===0?58:59),l(3),v(r.selectedApprovalForModal()?60:-1))},dependencies:[$,U,K,W,ve,_e,H,ue,Q,z,Y,J,ne],styles:[".form-label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:500;color:#d1d5db;margin-bottom:.25rem}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{display:block;width:100%;padding:.5rem .75rem;background:#11182766;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:12px;color:#f8fafc;font-size:.875rem}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{outline:none;background:#11182799;border-color:#60a5fa80;box-shadow:0 0 0 3px #60a5fa1a}.form-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}"]})};export{xe as ApprovalsComponent};
